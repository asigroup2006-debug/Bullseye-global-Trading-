<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#0e1016">
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>Bulls Eye ‚Äî Global Trading Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;background:#0e1016;}
body{color:#fff;font-family:'Inter',system-ui,sans-serif;font-size:14px;}
::-webkit-scrollbar{width:0;height:0;}
.app{height:100vh;display:flex;flex-direction:column;max-width:430px;margin:0 auto;background:#0e1016;}
.scr{display:none;flex:1;flex-direction:column;overflow:hidden;}
.scr.on{display:flex;}
.cnt{flex:1;overflow-y:auto;}

/* TOPBAR */
.topbar{display:flex;align-items:center;padding:10px 14px;gap:10px;background:#0e1016;flex-shrink:0;}
.srch-box{flex:1;display:flex;align-items:center;gap:8px;background:#1c2130;border-radius:10px;padding:9px 14px;}
.srch-box input{background:none;border:none;outline:none;color:#8b949e;font-size:14px;width:100%;font-family:'Inter',sans-serif;}
.tb-btn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:7px 11px;background:#1c2130;border-radius:10px;cursor:pointer;border:none;color:#fff;}
.tb-btn span{font-size:10px;color:#8b949e;font-weight:500;}

/* TICKER */
.strip{height:36px;background:#0e1016;border-bottom:1px solid #1a1f2e;overflow:hidden;display:flex;align-items:center;flex-shrink:0;}
.strip-inner{display:flex;animation:scroll 50s linear infinite;white-space:nowrap;}
@keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.si{display:inline-flex;align-items:center;gap:6px;padding:0 14px;border-right:1px solid #1a1f2e;}
.si-n{font-size:13px;color:#9ba3ae;font-weight:500;}
.si-p{font-size:13px;font-weight:700;color:#fff;}
.si-c{font-size:12px;font-weight:600;}
.up{color:#17c3a8!important;}.dn{color:#f0627a!important;}

/* H-TABS */
.h-tabs{display:flex;background:#0e1016;border-bottom:1px solid #1a1f2e;flex-shrink:0;overflow-x:auto;}
.h-tabs::-webkit-scrollbar{height:0;}
.htab{padding:12px 16px;font-size:14px;font-weight:500;color:#8b949e;cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap;}
.htab.act{color:#fff;border-bottom-color:#fff;}
.htab-gear{margin-left:auto;padding:12px 14px;color:#8b949e;flex-shrink:0;}

/* INDEX HEADER */
.idx-hdr{padding:14px 16px 8px;flex-shrink:0;}
.idx-top{display:flex;align-items:flex-start;justify-content:space-between;}
.idx-name{font-size:20px;font-weight:700;color:#fff;display:flex;align-items:center;gap:6px;cursor:pointer;}
.idx-name select{background:transparent;border:none;outline:none;color:#fff;font-size:20px;font-weight:700;cursor:pointer;appearance:none;-webkit-appearance:none;}
.idx-arrow{color:#8b949e;}
.idx-price{font-size:28px;font-weight:700;color:#fff;margin-top:4px;}
.idx-chg{font-size:14px;font-weight:600;margin-top:2px;}
.idx-exch{font-size:12px;color:#8b949e;margin-left:8px;font-weight:400;}

/* CHART TABS */
.chart-tabs{display:flex;border-bottom:1px solid #1a1f2e;flex-shrink:0;}
.ctab{padding:11px 16px;font-size:14px;color:#8b949e;border-bottom:2px solid transparent;cursor:pointer;font-weight:500;}
.ctab.act{color:#fff;border-bottom-color:#fff;}

/* CHART CONTROLS */
.chart-ctrl{display:flex;align-items:center;border-bottom:1px solid #1a1f2e;padding:8px 4px;}
.cc{display:flex;flex-direction:column;align-items:center;gap:3px;flex:1;cursor:pointer;padding:4px 6px;}
.cc-i{font-size:17px;color:#8b949e;}
.cc-t{font-size:13px;font-weight:600;color:#fff;}
.cc-l{font-size:10px;color:#8b949e;}

/* LIVE SNAPSHOT */
.lsnap{padding:16px;}
.lsnap-t{font-size:17px;font-weight:600;color:#fff;margin-bottom:16px;}
.snap-row{margin-bottom:18px;}
.snap-lbl{display:flex;justify-content:space-between;margin-bottom:8px;}
.snap-lo{font-size:12px;color:#8b949e;}
.snap-hi{font-size:12px;color:#8b949e;text-align:right;}
.snap-lv{font-size:16px;font-weight:700;color:#fff;margin-top:2px;}
.snap-bar{height:4px;background:#1c2130;border-radius:2px;position:relative;}
.snap-fill{height:100%;background:#17c3a8;border-radius:2px;}
.snap-dot{position:absolute;top:-4px;width:12px;height:12px;background:#fff;border-radius:50%;border:2px solid #17c3a8;margin-left:-6px;}

/* FU-OC BUTTONS */
.fo-row{display:flex;gap:10px;padding:0 16px 14px;}
.fo-btn{flex:1;display:flex;align-items:center;gap:8px;background:#1c2130;border-radius:12px;padding:14px 16px;cursor:pointer;border:none;color:#fff;font-size:14px;font-weight:600;}
.fo-btn svg{color:#8b949e;}
.fo-opt{background:linear-gradient(135deg,#5c2d91,#7c3aed);}
.fo-opt svg{color:#fff;}

/* SCALPER BANNER */
.scalper{margin:0 16px 16px;background:linear-gradient(135deg,#4a1d7a,#6d28d9);border-radius:14px;padding:16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;}
.sc-t{font-size:15px;font-weight:700;color:#fff;}
.sc-s{font-size:12px;color:rgba(255,255,255,.65);margin-top:3px;}

/* SECTION HEADER */
.sec-hdr{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 10px;}
.sec-ttl{font-size:16px;font-weight:700;color:#fff;display:flex;align-items:center;gap:6px;}
.sec-more{font-size:13px;font-weight:600;color:#fff;cursor:pointer;}

/* AI SIGNAL CARDS */
.ai-sig-row{display:flex;gap:10px;padding:0 16px 14px;overflow-x:auto;}
.ai-sig-row::-webkit-scrollbar{height:0;}
.ai-card{min-width:155px;background:#131820;border-radius:14px;padding:14px;cursor:pointer;border:1px solid #1a1f2e;flex-shrink:0;}
.ai-card-sym{font-size:16px;font-weight:700;color:#fff;margin-bottom:4px;}
.ai-card-pr{font-size:14px;color:#8b949e;margin-bottom:8px;}
.ai-badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:700;}
.ai-badge.buy{background:#17c3a81a;color:#17c3a8;border:1px solid #17c3a840;}
.ai-badge.sell{background:#f0627a1a;color:#f0627a;border:1px solid #f0627a40;}
.ai-card-acc{font-size:11px;color:#8b949e;margin-top:6px;}

/* GLOBAL SNAPSHOT CARDS */
.g-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 16px 14px;}
.g-card{background:#131820;border-radius:14px;padding:14px;cursor:pointer;border:1px solid #1a1f2e;}
.g-flag{font-size:20px;margin-bottom:6px;}
.g-region{font-size:11px;color:#8b949e;font-weight:500;margin-bottom:3px;}
.g-name{font-size:15px;font-weight:700;color:#fff;margin-bottom:6px;}
.g-price{font-size:20px;font-weight:700;color:#fff;margin-bottom:2px;}
.g-chg{font-size:13px;font-weight:600;}

/* COMMODITY CARDS */
.comm-row{display:flex;gap:10px;padding:0 16px 14px;overflow-x:auto;}
.comm-row::-webkit-scrollbar{height:0;}
.c-card{min-width:120px;background:#131820;border-radius:14px;padding:14px;flex-shrink:0;cursor:pointer;border:1px solid #1a1f2e;}
.c-icon{font-size:24px;margin-bottom:8px;}
.c-name{font-size:12px;color:#8b949e;font-weight:500;margin-bottom:4px;text-transform:uppercase;}
.c-price{font-size:17px;font-weight:700;color:#fff;margin-bottom:2px;}
.c-chg{font-size:12px;font-weight:600;}

/* AI MARKET PULSE */
.pulse-card{margin:0 16px 14px;background:#131820;border-radius:14px;padding:16px;border:1px solid #1a1f2e;}
.pulse-hdr{display:flex;align-items:center;gap:8px;margin-bottom:12px;}
.pulse-dot{width:8px;height:8px;border-radius:50%;background:#17c3a8;animation:blink 1.5s infinite;}
.pulse-ttl{font-size:14px;font-weight:700;color:#fff;letter-spacing:.5px;}
.pulse-row{display:flex;align-items:flex-start;gap:10px;margin-bottom:10px;}
.pulse-ico{font-size:16px;flex-shrink:0;margin-top:1px;}
.pulse-txt{font-size:14px;color:#cccccc;line-height:1.6;}
.pulse-txt b{color:#fff;}

/* NEWS CARDS */
.news-row{display:flex;flex-direction:column;gap:0;}
.news-card{display:flex;gap:12px;padding:14px 16px;border-bottom:1px solid #0d1017;cursor:pointer;}
.news-img{width:72px;height:56px;border-radius:10px;object-fit:cover;flex-shrink:0;background:#1c2130;display:flex;align-items:center;justify-content:center;font-size:22px;}
.news-body{flex:1;}
.news-src{font-size:11px;color:#8b949e;font-weight:600;margin-bottom:4px;text-transform:uppercase;letter-spacing:.3px;}
.news-ttl{font-size:14px;font-weight:600;color:#fff;line-height:1.5;margin-bottom:4px;}
.news-time{font-size:11px;color:#8b949e;}
.news-bull{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:4px;}

/* TOP PICKS */
.pick-row{display:flex;gap:10px;padding:0 16px 14px;overflow-x:auto;}
.pick-row::-webkit-scrollbar{height:0;}
.pick-card{min-width:160px;background:#131820;border-radius:14px;padding:14px;flex-shrink:0;cursor:pointer;border:1px solid #1a1f2e;}
.pick-sym{font-size:16px;font-weight:700;color:#fff;margin-bottom:2px;}
.pick-name{font-size:11px;color:#8b949e;margin-bottom:8px;}
.pick-pr{font-size:18px;font-weight:700;color:#fff;margin-bottom:4px;}
.pick-chg{font-size:13px;font-weight:600;}
.pick-badge{display:inline-flex;align-items:center;gap:3px;padding:3px 8px;border-radius:6px;font-size:11px;font-weight:700;margin-top:6px;}

/* VOICE BUTTON */
.voice-fab{position:fixed;bottom:80px;right:18px;width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#1a6b5e,#17c3a8);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:100;box-shadow:0 4px 20px rgba(23,195,168,.4);border:none;}
.voice-fab svg{color:#fff;}
.voice-fab.listening{animation:pulse-ring 1s infinite;}
@keyframes pulse-ring{0%{box-shadow:0 0 0 0 rgba(23,195,168,.5)}70%{box-shadow:0 0 0 14px rgba(23,195,168,0)}100%{box-shadow:0 0 0 0 rgba(23,195,168,0)}}

/* WATCHLIST */
.wl-hdr{padding:22px 16px 8px;}
.wl-t{font-size:28px;font-weight:700;color:#fff;letter-spacing:-.5px;}
.wl-tabs{display:flex;gap:6px;padding:6px 16px 12px;flex-shrink:0;}
.wltab{padding:8px 16px;border-radius:20px;font-size:14px;font-weight:500;cursor:pointer;border:1px solid #1c2130;color:#8b949e;background:transparent;}
.wltab.act{background:#fff;color:#000;border-color:#fff;}
.rdot{display:inline-block;width:8px;height:8px;background:#f0627a;border-radius:50%;margin-right:5px;animation:blink 1.5s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
.scan-tabs{display:flex;gap:6px;padding:8px 16px;overflow-x:auto;flex-shrink:0;}
.scan-tabs::-webkit-scrollbar{height:0;}
.stab{padding:7px 14px;border-radius:20px;font-size:13px;font-weight:500;border:1px solid #2a2f3e;color:#8b949e;cursor:pointer;background:transparent;white-space:nowrap;}
.stab.act{background:#fff;color:#000;border-color:#fff;}
.idx-filter{display:flex;align-items:center;justify-content:space-between;padding:4px 16px 10px;}
.ifl{font-size:13px;color:#8b949e;}
.ifd{display:flex;align-items:center;gap:6px;background:#1c2130;padding:7px 14px;border-radius:20px;font-size:13px;font-weight:600;color:#fff;cursor:pointer;}
.col-hdr{display:flex;padding:8px 16px;background:#0a0d14;}
.col-hdr span{font-size:11px;color:#8b949e;font-weight:500;letter-spacing:.4px;text-transform:uppercase;}
.wl-row{display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid #0d1017;cursor:pointer;}
.wl-row:active{background:#131820;}
.wl-lf{flex:1;}
.wl-nm{font-size:17px;font-weight:600;color:#fff;margin-bottom:3px;}
.wl-sb{font-size:13px;color:#8b949e;}
.wl-oi{width:115px;text-align:right;padding-right:6px;}
.wl-ov{font-size:15px;font-weight:600;margin-bottom:2px;}
.wl-op{font-size:12px;font-weight:600;}
.wl-rt{width:100px;text-align:right;}
.wl-pr{font-size:17px;font-weight:700;color:#fff;margin-bottom:2px;}
.wl-ch{font-size:13px;font-weight:600;}
.list-tabs{display:flex;border-bottom:1px solid #1a1f2e;overflow-x:auto;flex-shrink:0;align-items:center;}
.list-tabs::-webkit-scrollbar{height:0;}
.ltab{padding:10px 14px;font-size:14px;font-weight:500;color:#8b949e;cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap;}
.ltab.act{color:#fff;border-bottom-color:#fff;}
.ltab-ic{padding:10px 12px;color:#8b949e;font-size:18px;cursor:pointer;}
.add-stock{display:flex;align-items:center;gap:10px;background:#1c2130;margin:10px 16px;padding:12px 16px;border-radius:12px;cursor:pointer;border:none;color:#8b949e;font-size:14px;font-weight:500;width:calc(100% - 32px);}

/* DETAIL */
.det-hdr{padding:12px 16px 0;flex-shrink:0;}
.det-nav{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.bk-btn{width:34px;height:34px;border-radius:8px;background:#1c2130;display:flex;align-items:center;justify-content:center;border:none;color:#fff;font-size:16px;cursor:pointer;flex-shrink:0;}
.det-info{flex:1;}
.det-sym{font-size:20px;font-weight:700;color:#fff;display:flex;align-items:center;gap:8px;}
.det-badge{font-size:11px;color:#8b949e;background:#1c2130;padding:2px 8px;border-radius:4px;}
.det-price{font-size:28px;font-weight:700;color:#fff;margin-top:2px;}
.det-chg{font-size:14px;font-weight:600;margin-top:2px;}
.det-tabs{display:flex;border-bottom:1px solid #1a1f2e;overflow-x:auto;flex-shrink:0;}
.det-tabs::-webkit-scrollbar{height:0;}
.dtab{padding:11px 16px;font-size:14px;color:#8b949e;border-bottom:2px solid transparent;cursor:pointer;white-space:nowrap;font-weight:500;}
.dtab.act{color:#fff;border-bottom-color:#fff;}

/* TRADE BAR */
.trade-bar{display:flex;gap:10px;padding:12px 16px;background:#0e1016;border-top:1px solid #1a1f2e;flex-shrink:0;}
.buy-btn{flex:1;padding:14px;background:#17c3a8;border:none;border-radius:12px;font-size:16px;font-weight:700;color:#000;cursor:pointer;}
.sell-btn{flex:1;padding:14px;background:#f0627a;border:none;border-radius:12px;font-size:16px;font-weight:700;color:#fff;cursor:pointer;}

/* ORDERS */
.pg-hdr{padding:22px 16px 8px;flex-shrink:0;}
.pg-t{font-size:28px;font-weight:700;color:#fff;}
.pg-tabs{display:flex;border-bottom:1px solid #1a1f2e;padding:0 16px;flex-shrink:0;}
.pgtab{padding:12px 16px;font-size:14px;color:#8b949e;border-bottom:2px solid transparent;cursor:pointer;font-weight:500;}
.pgtab.act{color:#fff;border-bottom-color:#fff;font-weight:600;}
.ord-row{display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid #0d1017;cursor:pointer;}
.or-l{flex:1;}
.or-sym{font-size:16px;font-weight:600;color:#fff;margin-bottom:3px;}
.or-det{font-size:13px;color:#8b949e;}
.or-r{text-align:right;}
.or-st{font-size:13px;font-weight:600;margin-bottom:3px;}
.or-amt{font-size:14px;font-weight:700;color:#fff;}
.empty-st{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;gap:12px;color:#8b949e;padding:40px;}
.empty-st svg{opacity:.25;}
.empty-t{font-size:17px;font-weight:600;color:#fff;}

/* PORTFOLIO */
.pf-sum{margin:12px 16px;background:#131820;border-radius:16px;padding:20px;}
.pf-lbl{font-size:13px;color:#8b949e;margin-bottom:4px;}
.pf-val{font-size:32px;font-weight:700;color:#fff;}
.pf-ret{font-size:14px;font-weight:600;margin-top:4px;}
.pf-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px;}
.pf-cell{background:#0e1016;border-radius:10px;padding:10px;}
.pf-cl{font-size:12px;color:#8b949e;margin-bottom:4px;}
.pf-cv{font-size:15px;font-weight:700;color:#fff;}
.hold-row{display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid #0d1017;cursor:pointer;}
.h-ico{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;margin-right:12px;flex-shrink:0;}
.h-l{flex:1;}
.h-nm{font-size:16px;font-weight:600;color:#fff;margin-bottom:3px;}
.h-dt{font-size:13px;color:#8b949e;}
.h-r{text-align:right;}
.h-pnl{font-size:16px;font-weight:700;margin-bottom:2px;}
.h-pct{font-size:13px;font-weight:600;}

/* PROFILE */
.prof-pg{padding:0 16px 30px;}
.prof-av{width:76px;height:76px;background:#1a6b5e;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:30px;font-weight:700;color:#fff;margin:8px auto 12px;}
.prof-nm{font-size:22px;font-weight:700;color:#fff;text-align:center;}
.prof-lk{font-size:14px;color:#8b949e;text-align:center;margin-top:4px;display:flex;align-items:center;justify-content:center;gap:4px;cursor:pointer;}
.prof-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:16px 0;}
.pc{background:#1c2130;border-radius:14px;padding:16px 10px;text-align:center;cursor:pointer;}
.pc-ic{font-size:22px;margin-bottom:8px;}
.pc-v{font-size:15px;font-weight:700;color:#fff;margin-bottom:2px;}
.pc-l{font-size:12px;color:#8b949e;}
.sec-card{background:#1c2130;border-radius:14px;margin-bottom:10px;overflow:hidden;}
.sec-t{padding:14px 16px 4px;font-size:13px;font-weight:600;color:#8b949e;text-transform:uppercase;letter-spacing:.4px;}
.mr{display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid #131820;cursor:pointer;}
.mr:last-child{border-bottom:none;}
.mr-ic{width:36px;height:36px;background:#131820;border-radius:9px;display:flex;align-items:center;justify-content:center;margin-right:12px;font-size:17px;}
.mr-l{flex:1;}
.mr-t{font-size:15px;font-weight:500;color:#fff;}
.mr-s{font-size:12px;color:#8b949e;margin-top:2px;}
.mr-arr{color:#8b949e;font-size:18px;}
.badge{background:#6d28d9;color:#fff;font-size:10px;font-weight:700;padding:2px 7px;border-radius:20px;margin-left:6px;}

/* FUND GRID */
.fund-grid{display:grid;grid-template-columns:1fr 1fr;gap:1px;background:#1a1f2e;border-radius:12px;overflow:hidden;margin-bottom:14px;}
.fc{background:#131820;padding:12px;}
.fc-l{font-size:12px;color:#8b949e;margin-bottom:4px;}
.fc-v{font-size:14px;font-weight:700;color:#fff;}

/* SIMILAR STOCKS */
.sim-cards{display:flex;gap:10px;overflow-x:auto;padding:12px 16px;}
.sim-cards::-webkit-scrollbar{height:0;}
.sim-card{min-width:150px;background:#1c2130;border-radius:12px;padding:12px;flex-shrink:0;cursor:pointer;}
.sim-nm{font-size:14px;font-weight:600;color:#fff;margin-bottom:4px;}
.sim-pr{font-size:16px;font-weight:700;color:#fff;}
.sim-ch{font-size:13px;font-weight:600;}

/* PCR / IV CHARTS */
.pcr-wrap{background:#131820;border-radius:12px;padding:12px;margin-bottom:14px;}
.pcr-legend{display:flex;gap:12px;margin-bottom:8px;}
.pcr-leg{display:flex;align-items:center;gap:5px;font-size:12px;color:#8b949e;}
.pcr-dot{width:9px;height:9px;border-radius:50%;}
.pcr-exp{margin-left:auto;font-size:12px;color:#8b949e;}

/* ORDER OVERLAY */
.ov{position:fixed;inset:0;z-index:500;display:none;align-items:flex-end;background:rgba(0,0,0,.75);}
.ov.on{display:flex;}
.ov-sheet{width:100%;background:#131820;border-radius:20px 20px 0 0;padding:18px 18px 40px;}
.ov-bar{width:32px;height:3px;background:#2a2f3e;border-radius:2px;margin:0 auto 16px;}
.ov-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px;}
.ov-sym{font-size:18px;font-weight:700;color:#fff;}
.ov-mpr{font-size:13px;color:#8b949e;margin-top:3px;}
.ov-cls{width:28px;height:28px;background:#1c2130;border-radius:6px;border:none;color:#fff;font-size:14px;cursor:pointer;}
.ov-type{display:flex;gap:5px;background:#0e1016;padding:4px;border-radius:10px;margin-bottom:12px;}
.ov-tt{flex:1;padding:8px;border-radius:7px;border:none;background:transparent;font-size:13px;font-weight:600;cursor:pointer;color:#8b949e;}
.ov-tt.b-a{background:#17c3a8;color:#000;}
.ov-tt.s-a{background:#f0627a;color:#fff;}
.ov-seg{display:flex;gap:4px;background:#0e1016;padding:3px;border-radius:9px;margin-bottom:12px;}
.ov-sb{flex:1;padding:7px;border-radius:7px;border:none;background:transparent;font-size:12px;cursor:pointer;color:#8b949e;text-align:center;}
.ov-sb.act{background:#1c2130;color:#fff;}
.ov-lbl{font-size:12px;color:#8b949e;margin-bottom:5px;font-weight:500;}
.ov-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
.ov-inp{width:100%;background:#0e1016;border:1px solid #2a2f3e;border-radius:9px;padding:12px;color:#fff;font-size:15px;font-weight:600;outline:none;font-family:'Inter',sans-serif;}
.ov-inp:focus{border-color:#17c3a8;}
.ov-mg{display:flex;justify-content:space-between;background:#1a1f2e;border-radius:9px;padding:12px;margin-bottom:12px;}
.ov-mg span:first-child{font-size:13px;color:#8b949e;}
.ov-mg span:last-child{font-size:14px;font-weight:700;}
.ov-submit-buy{width:100%;padding:14px;border:none;border-radius:12px;background:#17c3a8;color:#000;font-size:16px;font-weight:700;cursor:pointer;}
.ov-submit-sell{width:100%;padding:14px;border:none;border-radius:12px;background:#f0627a;color:#fff;font-size:16px;font-weight:700;cursor:pointer;}

/* BOTTOM NAV */
.bnav{height:64px;display:flex;align-items:center;justify-content:space-around;background:#0e1016;border-top:1px solid #1a1f2e;flex-shrink:0;}
.bn{display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;padding:6px 12px;}
.bn-ic{font-size:22px;opacity:.35;line-height:1;}
.bn-lb{font-size:10px;font-weight:500;color:#8b949e;}
.bn.act .bn-ic{opacity:1;}
.bn.act .bn-lb{color:#fff;}
.trade-fab{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#5c2d91,#7c3aed);display:flex;align-items:center;justify-content:center;cursor:pointer;margin-top:-18px;box-shadow:0 4px 20px rgba(109,40,217,.5);}

/* NOTIF */
.notif{position:fixed;top:72px;left:50%;transform:translateX(-50%) translateY(-10px);background:#1c2130;border:1px solid #2a2f3e;border-radius:14px;padding:12px 16px;z-index:700;opacity:0;pointer-events:none;transition:all .25s;min-width:280px;max-width:90vw;box-shadow:0 8px 40px rgba(0,0,0,.7);}
.notif.on{opacity:1;transform:translateX(-50%) translateY(0);}
.n-t{font-size:13px;font-weight:700;color:#fff;margin-bottom:2px;}
.n-b{font-size:12px;color:#8b949e;}
</style>
</head>
<body>
<div class="app">

<!-- ‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê -->
<div class="scr on" id="homeScreen">
  <div class="topbar">
    <div class="srch-box">
      <svg width="15" height="15" fill="none" stroke="#8b949e" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input placeholder="Search futures, stocks, indices..." readonly>
    </div>
    <div class="tb-btn" onclick="goTo('portfolio')">
      <svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
      <span>Funds</span>
    </div>
    <div class="tb-btn" onclick="showAlertsScreen()" style="position:relative;">
      <svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      <span id="alertBadge" style="display:none;position:absolute;top:4px;right:6px;width:8px;height:8px;background:#f0627a;border-radius:50%;"></span>
      <span>Alerts</span>
    </div>
    <div class="tb-btn" onclick="goTo('profile')">
      <svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span>Profile</span>
    </div>
  </div>
  <div class="strip" id="strip"></div>
  <div class="h-tabs">
    <div class="htab act" onclick="setHTab(this,'fo')">F&O</div>
    <div class="htab" onclick="setHTab(this,'stocks')">Stocks</div>
    <div class="htab" onclick="setHTab(this,'research')">Research</div>
    <div class="htab" onclick="setHTab(this,'ipo')">IPO</div>
    <div class="htab" onclick="setHTab(this,'etfs')">ETFs</div>
    <div class="htab-gear">‚öôÔ∏è</div>
  </div>
  <div class="cnt" id="homeC"></div>
</div>

<!-- ‚ïê‚ïê‚ïê WATCHLIST ‚ïê‚ïê‚ïê -->
<div class="scr" id="watchlistScreen">
  <div class="wl-hdr"><div class="wl-t">My Watchlist</div></div>
  <div class="wl-tabs">
    <div class="wltab" id="wt0" onclick="setWTab('mylist')">My Lists</div>
    <div class="wltab" id="wt1" onclick="setWTab('scanner')"><span class="rdot"></span>Stock Scanners</div>
    <div class="wltab" id="wt2" onclick="setWTab('recent')">Recently viewed</div>
  </div>
  <div class="cnt" id="wlC"></div>
</div>

<!-- ‚ïê‚ïê‚ïê ORDERS ‚ïê‚ïê‚ïê -->
<div class="scr" id="ordersScreen">
  <div class="pg-hdr"><div class="pg-t">Orders</div></div>
  <div class="pg-tabs">
    <div class="pgtab act">Pending</div>
    <div class="pgtab">Executed</div>
    <div class="pgtab">All</div>
  </div>
  <div class="cnt" id="ordersC"></div>
</div>

<!-- ‚ïê‚ïê‚ïê PORTFOLIO ‚ïê‚ïê‚ïê -->
<div class="scr" id="portfolioScreen">
  <div class="pg-hdr"><div class="pg-t">Portfolio</div></div>
  <div class="pg-tabs">
    <div class="pgtab act">Holdings</div>
    <div class="pgtab">Positions</div>
  </div>
  <div class="cnt" id="pfC"></div>
</div>

<!-- ‚ïê‚ïê‚ïê DETAIL ‚ïê‚ïê‚ïê -->
<div class="scr" id="detailScreen">
  <div class="det-hdr">
    <div class="det-nav">
      <button class="bk-btn" onclick="goBack()">‚Üê</button>
      <div class="det-info">
        <div class="det-sym">
          <span id="dSym">RELIANCE</span>
          <span style="color:#8b949e;font-size:14px;cursor:pointer;" onclick="">‚ñº</span>
          <span class="det-badge" id="dExch">NSE</span>
        </div>
        <div class="det-price" id="dPrice">‚Çπ2,847</div>
        <div class="det-chg dn" id="dChg">-15.95 (0.56%)</div>
      </div>
      <div style="width:34px;height:34px;background:#1c2130;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#8b949e;font-size:16px;margin-left:auto;">üîç</div>
    </div>
  </div>
  <div class="det-tabs" id="detTabs">
    <div class="dtab act" onclick="setDTab(this,'chart')">Chart</div>
    <div class="dtab" onclick="setDTab(this,'options')">Options analytics</div>
    <div class="dtab" onclick="setDTab(this,'fundamentals')">Fundamentals</div>
    <div class="dtab" onclick="setDTab(this,'shareholding')">Shareholding</div>
  </div>
  <div class="cnt" id="detC"></div>
  <div class="trade-bar">
    <button class="buy-btn" onclick="openOrder('BUY')">Buy</button>
    <button class="sell-btn" onclick="openOrder('SELL')">Sell</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê -->
<div class="scr" id="profileScreen">
  <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 16px;flex-shrink:0;">
    <button class="bk-btn" onclick="goTo('home')">‚Üê</button>
    <span style="color:#8b949e;cursor:pointer;font-size:18px;">‚öôÔ∏è</span>
  </div>
  <div class="cnt" id="profC"></div>
</div>

<!-- ‚ïê‚ïê‚ïê BOTTOM NAV ‚ïê‚ïê‚ïê -->
<div class="bnav" id="bnav">
  <div class="bn act" id="bn-home" onclick="goTo('home')"><div class="bn-ic">üè†</div><div class="bn-lb">Home</div></div>
  <div class="bn" id="bn-watchlist" onclick="goTo('watchlist')"><div class="bn-ic">üîñ</div><div class="bn-lb">Watchlist</div></div>
  <div class="trade-fab" onclick="openOrder('BUY')">
    <svg width="22" height="22" fill="none" stroke="#fff" stroke-width="2.5" viewBox="0 0 24 24"><path d="M7 16V4m0 0L3 8m4-4 4 4M17 8v12m0 0 4-4m-4 4-4-4"/></svg>
  </div>
  <div class="bn" id="bn-orders" onclick="goTo('orders')"><div class="bn-ic">üìã</div><div class="bn-lb">Orders</div></div>
  <div class="bn" id="bn-portfolio" onclick="goTo('portfolio')"><div class="bn-ic">üíº</div><div class="bn-lb">Portfolio</div></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê ORDER OVERLAY ‚ïê‚ïê‚ïê -->
<div class="ov" id="ov" onclick="if(event.target===this)closeOrder()">
  <div class="ov-sheet">
    <div class="ov-bar"></div>
    <div class="ov-top">
      <div>
        <div class="ov-sym" id="ovSym">RELIANCE</div>
        <div class="ov-mpr" id="ovMPr">‚Çπ2,847 ¬∑ NSE</div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <div class="ov-type" style="margin:0;">
          <button class="ov-tt b-a" id="ovB" onclick="setOT('BUY')">BUY</button>
          <button class="ov-tt" id="ovS" onclick="setOT('SELL')">SELL</button>
        </div>
        <button class="ov-cls" onclick="closeOrder()">‚úï</button>
      </div>
    </div>
    <div class="ov-seg" id="ovSeg1">
      <button class="ov-sb act" onclick="oS(this)">Intraday</button>
      <button class="ov-sb" onclick="oS(this)">Delivery</button>
      <button class="ov-sb" onclick="oS(this)">MTF</button>
    </div>
    <div class="ov-seg" id="ovSeg2">
      <button class="ov-sb act" onclick="oS(this)">LIMIT</button>
      <button class="ov-sb" onclick="oS(this)">MARKET</button>
      <button class="ov-sb" onclick="oS(this)">SL</button>
      <button class="ov-sb" onclick="oS(this)">SL-M</button>
    </div>
    <div class="ov-row">
      <div><div class="ov-lbl">PRICE (‚Çπ)</div><input class="ov-inp" type="number" id="ovPr" oninput="calcMg()"></div>
      <div><div class="ov-lbl">QUANTITY</div><input class="ov-inp" type="number" id="ovQt" value="1" oninput="calcMg()"></div>
    </div>
    <div class="ov-mg"><span>Margin Required</span><span id="ovMg">‚Çπ569</span></div>
    <button class="ov-submit-buy" id="ovBtn" onclick="placeOrder()">‚ö° Confirm BUY</button>
  </div>
</div>

<!-- VOICE FAB -->
<button class="voice-fab" id="voiceBtn" onclick="toggleVoice()">
  <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
</button>

<!-- NOTIF -->
<div class="notif" id="notif">
  <div style="display:flex;gap:10px;align-items:flex-start;">
    <span id="nIco" style="font-size:18px;">üìà</span>
    <div><div class="n-t" id="nTit"></div><div class="n-b" id="nBod"></div></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const IDXS=[
  {s:'NIFTY 50',  p:25178.65,c:-317.90,pct:-1.25,e:'NSE'},
  {s:'BANKNIFTY', p:53490.25,c:-858.70,pct:-1.58,e:'NSE'},
  {s:'SENSEX',    p:81287.19,c:-961.42,pct:-1.17,e:'BSE'},
  {s:'FINNIFTY',  p:23842.10,c:-198.45,pct:-0.82,e:'NSE'},
  {s:'GIFTNIFTY', p:25195.00,c:+16.35, pct:+0.06,e:'SGX'},
  {s:'MIDCPNIFTY',p:12847.30,c:-87.20, pct:-0.67,e:'NSE'},
];
const GIDX=[
  {s:'DOW JONES',p:38847,c:+0.62,f:'üá∫üá∏'},{s:'S&P 500',p:4924,c:+0.48,f:'üá∫üá∏'},
  {s:'NASDAQ',p:15628,c:+0.91,f:'üá∫üá∏'},{s:'NIKKEI 225',p:37785,c:+1.24,f:'üáØüáµ'},
  {s:'HANG SENG',p:16482,c:-1.12,f:'üá≠üá∞'},{s:'FTSE 100',p:7682,c:-0.23,f:'üá¨üáß'},
  {s:'SHANGHAI',p:3024,c:-0.87,f:'üá®üá≥'},{s:'STI',p:3248,c:+0.43,f:'üá∏üá¨'},
];
const COMM=[
  {s:'GOLD',p:2028.40,c:+0.32,i:'ü•á'},{s:'SILVER',p:23.84,c:-0.18,i:'ü•à'},
  {s:'CRUDE OIL',p:78.42,c:-0.63,i:'üõ¢Ô∏è'},{s:'NAT GAS',p:2.84,c:+1.24,i:'‚õΩ'},
  {s:'COPPER',p:3.84,c:+0.54,i:'üî∂'},{s:'PLATINUM',p:918,c:+0.21,i:'üíé'},
];
const STOCKS=[
  {s:'RELIANCE',  n:'Reliance Industries',       p:2847.30,c:-15.40,pct:-0.54,sec:'Oil & Gas',col:'#17c3a8'},
  {s:'HDFCBANK',  n:'HDFC Bank Ltd',             p:1623.80,c:+8.45, pct:+0.52,sec:'Banking',  col:'#6b88ff'},
  {s:'ICICIBANK', n:'ICICI Bank',                p:1089.60,c:+22.80,pct:+2.14,sec:'Banking',  col:'#f0627a'},
  {s:'TCS',       n:'Tata Consultancy Services', p:3912.50,c:+34.10,pct:+0.88,sec:'IT',        col:'#a78bfa'},
  {s:'INFOSYS',   n:'Infosys Ltd',               p:1782.40,c:+12.30,pct:+0.70,sec:'IT',        col:'#34d399'},
  {s:'WIPRO',     n:'Wipro Ltd',                 p:498.35, c:-2.80, pct:-0.56,sec:'IT',        col:'#fb923c'},
  {s:'TATAMOTORS',n:'Tata Motors Ltd',           p:982.70, c:+30.50,pct:+3.21,sec:'Auto',      col:'#22d3ee'},
  {s:'BAJFINANCE',n:'Bajaj Finance Ltd',         p:7234.50,c:+134.2,pct:+1.89,sec:'NBFC',      col:'#f59e0b'},
  {s:'TATASTEEL', n:'Tata Steel Ltd',            p:142.60, c:-1.40, pct:-0.97,sec:'Metal',     col:'#94a3b8'},
  {s:'ONGC',      n:'ONGC Ltd',                  p:267.80, c:-2.00, pct:-0.74,sec:'Oil & Gas', col:'#84cc16'},
  {s:'MARUTI',    n:'Maruti Suzuki India',       p:12437.5,c:+122.3,pct:+0.98,sec:'Auto',      col:'#6b88ff'},
  {s:'LTFH',      n:'L&T Finance Holdings',      p:283.95, c:+14.25,pct:+5.32,sec:'NBFC',      col:'#17c3a8'},
];
const SCANS={
  gainers:   [{s:'Tejas Networks',p:435.85,c:+64.80,pct:+17.46},{s:'Redington',p:280.45,c:+35.90,pct:+14.68},{s:'Sarda Energy',p:551.60,c:+32.70,pct:+6.30},{s:'Sun TV Network',p:647.65,c:+36.25,pct:+5.93},{s:'L&T Tech Svcs',p:3512.40,c:+195.0,pct:+5.88},{s:'Chennai Petro',p:961.95,c:+45.50,pct:+4.96},{s:'Jaiprakash Power',p:15.25,c:+0.70,pct:+4.81},{s:'Finolex Cables',p:913.70,c:+40.35,pct:+4.62}],
  losers:    [{s:'LTFH',p:283.95,c:-15.95,pct:-5.32},{s:'Wipro',p:498.35,c:-18.80,pct:-3.63},{s:'Tata Steel',p:142.60,c:-4.45,pct:-3.02},{s:'ONGC',p:267.80,c:-7.20,pct:-2.62},{s:'Coal India',p:387.45,c:-9.20,pct:-2.31},{s:'NTPC',p:334.20,c:-7.65,pct:-2.24},{s:'BHEL',p:234.75,c:-4.90,pct:-2.04},{s:'SAIL',p:127.40,c:-2.55,pct:-1.96}],
  volume:    [{s:'RELIANCE',p:2847.30,c:-15.40,pct:-0.54,vol:'18.4Cr'},{s:'HDFCBANK',p:1623.80,c:+8.45,pct:+0.52,vol:'12.2Cr'},{s:'TATAMOTORS',p:982.70,c:+30.50,pct:+3.21,vol:'9.8Cr'},{s:'ICICIBANK',p:1089.60,c:+22.80,pct:+2.14,vol:'8.7Cr'},{s:'ZOMATO',p:198.40,c:-4.20,pct:-2.07,vol:'7.6Cr'}],
  shortcover:[{s:'Angel One',n:'Angel One Ltd',oi:'-21.38%',oiL:'308.32L',p:233.20,c:+5.40},{s:'LTFH',n:'L&T Finance Hldgs',oi:'-34.78%',oiL:'669.22L',p:283.95,c:+5.32},{s:'CAMS',n:'Computer Age Mgmt',oi:'-5.17%',oiL:'67.89L',p:677.60,c:+4.37},{s:'PPLPHARMA',n:'Piramal Pharma',oi:'-2.36%',oiL:'186.64L',p:156.13,c:+3.87},{s:'GODREJPROP',n:'Godrej Properties',oi:'-1.92%',oiL:'81.32L',p:1731.00,c:+3.72},{s:'UNOMINDA',n:'UNO Minda',oi:'-2.03%',oiL:'66.98L',p:1188.50,c:+3.42},{s:'BSE',n:'BSE Ltd',oi:'-18.53%',oiL:'107.43L',p:2707.10,c:+3.35},{s:'MANAPPURAM',n:'Manappuram Finance',oi:'-4.21%',oiL:'506.73L',p:283.25,c:+3.18}],
  shortbuild:[{s:'HDFCLIFE',n:'HDFC Life Insurance',oi:'+28.45%',oiL:'412.38L',p:624.30,c:-4.20},{s:'SBICARD',n:'SBI Cards',oi:'+19.32%',oiL:'287.64L',p:712.85,c:-3.95},{s:'INDUSTOWER',n:'Indus Towers',oi:'+15.67%',oiL:'523.41L',p:334.60,c:-3.75},{s:'MUTHOOTFIN',n:'Muthoot Finance',oi:'+12.88%',oiL:'178.92L',p:1842.45,c:-3.40},{s:'TATAPOWER',n:'Tata Power',oi:'+11.23%',oiL:'892.34L',p:382.75,c:-3.15},{s:'ZOMATO',n:'Zomato Ltd',oi:'+9.76%',oiL:'1243.67L',p:198.40,c:-2.90}],
  longbuild: [{s:'RELIANCE',n:'Reliance Industries',oi:'+18.43%',oiL:'1243.56L',p:2847.00,c:+1.53},{s:'HDFCBANK',n:'HDFC Bank Ltd',oi:'+14.21%',oiL:'2341.23L',p:1623.45,c:+1.38},{s:'ICICIBANK',n:'ICICI Bank',oi:'+12.67%',oiL:'3421.87L',p:1089.30,c:+2.11},{s:'TCS',n:'TCS Ltd',oi:'+9.34%',oiL:'456.78L',p:3912.00,c:+1.24},{s:'LT',n:'L&T Ltd',oi:'+8.76%',oiL:'678.34L',p:3487.25,c:+1.67},{s:'MARUTI',n:'Maruti Suzuki',oi:'+6.54%',oiL:'123.45L',p:12437.50,c:+0.98}],
  longunwind:[{s:'WIPRO',n:'Wipro Ltd',oi:'-8.87%',oiL:'1234.56L',p:498.35,c:-1.15},{s:'TATASTEEL',n:'Tata Steel',oi:'-7.95%',oiL:'4521.34L',p:142.60,c:-0.98},{s:'COALINDIA',n:'Coal India',oi:'-6.32%',oiL:'2341.78L',p:387.45,c:-0.87},{s:'ONGC',n:'ONGC Ltd',oi:'-5.76%',oiL:'3456.23L',p:267.80,c:-0.74},{s:'NTPC',n:'NTPC Ltd',oi:'-4.54%',oiL:'2134.56L',p:334.20,c:-0.65},{s:'POWERGRID',n:'Power Grid Corp',oi:'-3.87%',oiL:'1876.43L',p:284.55,c:-0.52}],
  rsi_os:    [{s:'ONGC',p:267.80,c:-0.74,rsi:28},{s:'SAIL',p:127.40,c:-0.43,rsi:24},{s:'BHEL',p:234.75,c:-0.38,rsi:26},{s:'COALINDIA',p:387.45,c:-0.87,rsi:29},{s:'POWERGRID',p:284.55,c:-0.52,rsi:27}],
  rsi_ob:    [{s:'ICICIBANK',p:1089.30,c:+2.11,rsi:78},{s:'BAJFINANCE',p:7234.50,c:+1.89,rsi:76},{s:'TATAMOTORS',p:982.70,c:+3.21,rsi:74},{s:'MARUTI',p:12437.50,c:+0.98,rsi:72},{s:'TITAN',p:3267.80,c:+0.76,rsi:71}],
};
const MYLISTS={
  'Power':['NTPC','POWERGRID','TATAMOTORS','ONGC','BHEL'],
  'Defence':['RELIANCE','TCS','INFOSYS','WIPRO','HDFCBANK'],
  'IT sector':['TCS','INFOSYS','WIPRO','TATAMOTORS','ICICIBANK'],
  'Banking':['HDFCBANK','ICICIBANK','TATASTEEL','BAJFINANCE','MARUTI'],
};
const HOLDS=[
  {s:'RELIANCE',qty:50,avg:2680,col:'#17c3a8'},{s:'TCS',qty:20,avg:3820,col:'#a78bfa'},
  {s:'ICICIBANK',qty:100,avg:980,col:'#f0627a'},{s:'BAJFINANCE',qty:15,avg:6800,col:'#f59e0b'},
  {s:'INFOSYS',qty:40,avg:1700,col:'#34d399'},
];

// STATE
let curS=STOCKS[0],oType='BUY',wTab='mylist',scanTab='shortcover',listTab='Power',hTab='fo',dTab='chart',prevScr='watchlist',curIdx=0;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TICKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildTicker(){
  const all=[...IDXS.map(x=>({s:x.s,p:x.p,c:x.c})),...GIDX.map(x=>({s:x.f+' '+x.s,p:x.p,c:x.c})),...COMM.map(x=>({s:x.i+' '+x.s,p:x.p,c:x.c}))];
  const h=[...all,...all].map(x=>`<span class="si"><span class="si-n">${x.s}</span><span class="si-p">${x.p.toLocaleString('en-IN',{maximumFractionDigits:2})}</span><span class="si-c ${x.c>=0?'up':'dn'}">${x.c>=0?'‚ñ≤':'‚ñº'}${Math.abs(x.c).toFixed(2)}%</span></span>`).join('');
  document.getElementById('strip').innerHTML=`<div class="strip-inner">${h}</div>`;
}
buildTicker();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SCRS=['home','watchlist','orders','portfolio','detail','profile'];
function goTo(id){
  if(id==='detail') prevScr=document.querySelector('.scr.on')?.id.replace('Screen','')||'watchlist';
  SCRS.forEach(s=>document.getElementById(s+'Screen')?.classList.toggle('on',s===id));
  const nav=document.getElementById('bnav');
  nav.style.display=['detail','profile'].includes(id)?'none':'flex';
  ['home','watchlist','orders','portfolio'].forEach(s=>document.getElementById('bn-'+s)?.classList.toggle('act',s===id));
  if(id==='home')     buildHome();
  if(id==='watchlist'){buildWL();setWTabActive();}
  if(id==='orders')   buildOrders();
  if(id==='portfolio')buildPF();
  if(id==='profile')  buildProf();
}
function goBack(){goTo(prevScr);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setHTab(el,t){document.querySelectorAll('.htab').forEach(x=>x.classList.remove('act'));el.classList.add('act');hTab=t;buildHome();}
const AI_SIGNALS=[
  {s:'RELIANCE', p:2847,  sig:'BUY',  acc:'84%', reason:'Breakout + Volume surge'},
  {s:'ICICIBANK',p:1089,  sig:'BUY',  acc:'81%', reason:'RSI reversal at support'},
  {s:'HDFCBANK', p:1623,  sig:'BUY',  acc:'79%', reason:'Golden cross + FII buying'},
  {s:'WIPRO',    p:498,   sig:'SELL', acc:'77%', reason:'Bearish engulfing + weak OI'},
  {s:'TATASTEEL',p:142,   sig:'SELL', acc:'75%', reason:'Long unwinding detected'},
  {s:'TCS',      p:3912,  sig:'BUY',  acc:'82%', reason:'Strong quarterly results'},
];
const NEWS=[
  {ico:'üìà',src:'Economic Times',title:'Nifty may test 25,500 as FIIs turn buyers; ICICI Bank, Reliance in focus',time:'2 min ago',bull:true},
  {ico:'üè¶',src:'Moneycontrol',title:'RBI keeps repo rate unchanged at 6.5%; MPC policy stance remains withdrawal',time:'18 min ago',bull:true},
  {ico:'‚õΩ',src:'Bloomberg',title:'Crude oil rises 1.2% on Middle East tensions; ONGC, BPCL stocks may gain',time:'32 min ago',bull:true},
  {ico:'üìâ',src:'LiveMint',title:'IT sector faces headwinds as US tech spending slows; TCS, Infosys cautious',time:'1 hr ago',bull:false},
  {ico:'üè≠',src:'Business Standard',title:'Tata Motors Q3 profit jumps 138% on JLR recovery; stock gains 3.2%',time:'2 hr ago',bull:true},
  {ico:'üíä',src:'CNBC TV18',title:'Sun Pharma gets USFDA nod for generic drug; exports to boost revenue',time:'3 hr ago',bull:true},
];
const VOICE_CMDS=[
  'Show RELIANCE price','Buy 10 lots Nifty','What is PCR today','Show top gainers',
  'Open HDFC Bank chart','Set alert for Nifty 25500','Show my portfolio','Check Sensex'
];

function buildHome(){
  const idx=IDXS[curIdx],up=idx.c>=0;
  const idxOpts=IDXS.map((x,i)=>`<option value="${i}" style="background:#1c2130;color:#fff;"${i===curIdx?' selected':''}>${x.s}</option>`).join('');
  document.getElementById('homeC').innerHTML=`
  <div class="idx-hdr">
    <div class="idx-top">
      <div>
        <div class="idx-name">
          <select onchange="curIdx=+this.value;buildHome()">${idxOpts}</select>
          <span class="idx-arrow">‚ñº</span>
        </div>
        <div class="idx-price">${idx.p.toLocaleString('en-IN',{maximumFractionDigits:2})}</div>
        <div class="idx-chg ${up?'up':'dn'}">${up?'+':''}${idx.c.toFixed(2)} (${Math.abs(idx.pct).toFixed(2)}%)<span class="idx-exch">${idx.e}</span></div>
      </div>
    </div>
  </div>
  <div class="chart-tabs">
    <div class="ctab act">Chart</div>
    <div class="ctab">Options analytics</div>
    <div class="ctab">Stocks</div>
  </div>
  <canvas id="hChart" width="430" height="200" style="display:block;"></canvas>
  <div class="chart-ctrl">
    <div class="cc"><div class="cc-i">‚Üî</div><div class="cc-l">Range</div></div>
    <div class="cc"><div class="cc-t">1 min</div><div class="cc-l">Interval</div></div>
    <div class="cc"><div class="cc-i" style="font-style:italic;font-weight:700;">f</div><div class="cc-l">Indicators</div></div>
    <div class="cc"><div class="cc-i">‚úèÔ∏è</div><div class="cc-l">Drawings</div></div>
    <div class="cc"><div class="cc-i">‚öôÔ∏è</div><div class="cc-l">Settings</div></div>
    <div class="cc"><div class="cc-i">‚õ∂</div></div>
  </div>
  <div class="fo-row">
    <button class="fo-btn" onclick="notif('üìä','Futures','${idx.s} Futures ‚Äî Dec Expiry')"><svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Futures</button>
    <button class="fo-btn fo-opt" onclick="notif('üîó','Option Chain','${idx.s} ‚Äî PCR: 1.24, ATM IV: 14.2')"><svg width="17" height="17" fill="none" stroke="#fff" stroke-width="2" viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>Option Chain</button>
  </div>
  <div class="lsnap">
    <div class="lsnap-t">Live snapshot</div>
    <div class="snap-row">
      <div class="snap-lbl">
        <div><div class="snap-lo">Today's low</div><div class="snap-lv">${(idx.p*.989).toFixed(2)}</div></div>
        <div style="text-align:right;"><div class="snap-lo">Today's high</div><div class="snap-lv">${(idx.p*1.008).toFixed(2)}</div></div>
      </div>
      <div class="snap-bar"><div class="snap-fill" style="width:35%;"></div><div class="snap-dot" style="left:35%;"></div></div>
    </div>
    <div class="snap-row">
      <div class="snap-lbl">
        <div><div class="snap-lo">52 W Low</div><div class="snap-lv">${(idx.p*.79).toFixed(2)}</div></div>
        <div style="text-align:right;"><div class="snap-lo">52 W High</div><div class="snap-lv">${(idx.p*1.14).toFixed(2)}</div></div>
      </div>
      <div class="snap-bar"><div class="snap-fill" style="width:61%;background:#6b88ff;"></div><div class="snap-dot" style="left:61%;border-color:#6b88ff;"></div></div>
    </div>
  </div>
  <div class="scalper" onclick="notif('‚ö°','Options Scalper','Live AI signals active for ${idx.s}')">
    <div><div class="sc-t">Enter Options Scalper ‚Üí</div><div class="sc-s">Live signals ¬∑ AI momentum detection</div></div>
    <span style="font-size:20px;color:#fff;">‚Ä∫</span>
  </div>

  <!-- AI SIGNALS -->
  <div class="sec-hdr"><div class="sec-ttl">ü§ñ AI BUY/SELL SIGNALS</div><div class="sec-more" onclick="notif('ü§ñ','AI Signals','82% accuracy ¬∑ Updated every 15 min')">SEE ALL</div></div>
  <div class="ai-sig-row">
    ${AI_SIGNALS.map(a=>`<div class="ai-card" onclick="openDet('${a.s}')">
      <div class="ai-card-sym">${a.s}</div>
      <div class="ai-card-pr">‚Çπ${a.p.toLocaleString('en-IN')}</div>
      <div class="ai-badge ${a.sig==='BUY'?'buy':'sell'}">${a.sig==='BUY'?'‚ñ≤':'‚ñº'} ${a.sig}</div>
      <div class="ai-card-acc">Accuracy: ${a.acc} ¬∑ ${a.reason}</div>
    </div>`).join('')}
  </div>

  <!-- AI MARKET PULSE -->
  <div class="pulse-card">
    <div class="pulse-hdr"><div class="pulse-dot"></div><div class="pulse-ttl">ü§ñ AI MARKET PULSE</div></div>
    <div class="pulse-row"><div class="pulse-ico">üü¢</div><div class="pulse-txt"><b>Nifty bullish:</b> PCR 1.24 ‚Äî put writers active at 25000. Bias positive.</div></div>
    <div class="pulse-row"><div class="pulse-ico">üåç</div><div class="pulse-txt"><b>Global cues:</b> US markets green, Gift Nifty +76 pts, positive open expected.</div></div>
    <div class="pulse-row"><div class="pulse-ico">ü•á</div><div class="pulse-txt"><b>Gold $2028:</b> Safe haven buying. Watch energy & metal stocks.</div></div>
    <div class="pulse-row" style="margin-bottom:0;"><div class="pulse-ico">üí°</div><div class="pulse-txt"><b>Best bets:</b> ICICIBANK, BAJFINANCE dips mein accumulate karo.</div></div>
  </div>

  <!-- TOP AI PICKS -->
  <div class="sec-hdr"><div class="sec-ttl">üéØ TOP AI PICKS</div><div class="sec-more">SEE ALL</div></div>
  <div class="pick-row">
    ${STOCKS.slice(0,6).map(s=>{const up=s.c>=0;return`<div class="pick-card" onclick="openDet('${s.s}')">
      <div class="pick-sym">${s.s}</div>
      <div class="pick-name">${s.n}</div>
      <div class="pick-pr">‚Çπ${s.p.toLocaleString('en-IN',{maximumFractionDigits:2})}</div>
      <div class="pick-chg ${up?'up':'dn'}">${up?'+':''}${s.c.toFixed(2)} (${Math.abs(s.pct).toFixed(2)}%)</div>
      <div class="pick-badge" style="background:${up?'#17c3a81a':'#f0627a1a'};color:${up?'#17c3a8':'#f0627a'};border:1px solid ${up?'#17c3a840':'#f0627a40'};">${up?'‚ñ≤ BUY':'‚ñº SELL'}</div>
    </div>`}).join('')}
  </div>

  <!-- GLOBAL SNAPSHOT -->
  <div class="sec-hdr"><div class="sec-ttl">üåç GLOBAL SNAPSHOT</div><div class="sec-more" onclick="notif('üåç','Global Markets','14 markets tracked live')">MORE</div></div>
  <div class="g-grid">
    ${GIDX.slice(0,6).map(g=>{const up=g.c>=0;return`<div class="g-card" onclick="notif('${g.f}','${g.s}','${g.p.toLocaleString()} ¬∑ ${up?'+':''}${g.c}%')">
      <div class="g-flag">${g.f}</div>
      <div class="g-region">${g.f==='üá∫üá∏'?'USA':g.f==='üáØüáµ'?'Japan':g.f==='üá≠üá∞'?'Hong Kong':g.f==='üá¨üáß'?'Europe':g.f==='üá®üá≥'?'China':'Global'}</div>
      <div class="g-name">${g.s}</div>
      <div class="g-price">${g.p.toLocaleString('en-IN')}</div>
      <div class="g-chg ${up?'up':'dn'}">${up?'‚ñ≤':'‚ñº'} ${Math.abs(g.c).toFixed(2)}%</div>
    </div>`}).join('')}
  </div>

  <!-- COMMODITIES -->
  <div class="sec-hdr"><div class="sec-ttl">‚ö° COMMODITIES</div><div class="sec-more">MORE</div></div>
  <div class="comm-row">
    ${COMM.map(c=>{const up=c.c>=0;return`<div class="c-card" onclick="notif('${c.i}','${c.s}','$${c.p} ¬∑ ${up?'+':''}${c.c}%')">
      <div class="c-icon">${c.i}</div>
      <div class="c-name">${c.s}</div>
      <div class="c-price">${c.p.toLocaleString('en-IN',{maximumFractionDigits:2})}</div>
      <div class="c-chg ${up?'up':'dn'}">${up?'‚ñ≤':'‚ñº'} ${Math.abs(c.c).toFixed(2)}%</div>
    </div>`}).join('')}
  </div>

  <!-- LATEST NEWS -->
  <div class="sec-hdr"><div class="sec-ttl">üì∞ LATEST NEWS</div><div class="sec-more">SEE ALL</div></div>
  <div class="news-row">
    ${NEWS.map(n=>`<div class="news-card" onclick="notif('${n.ico}',${JSON.stringify(n.src)},${JSON.stringify(n.title)})">
      <div class="news-img">${n.ico}</div>
      <div class="news-body">
        <div class="news-src"><span class="news-bull" style="background:${n.bull?'#17c3a8':'#f0627a'};"></span>${n.src}</div>
        <div class="news-ttl">${n.title}</div>
        <div class="news-time">${n.time}</div>
      </div>
    </div>`).join('')}
  </div>

  <div style="height:80px;"></div>`;
  setTimeout(()=>drawCandles('hChart',430,200,idx.p,up),40);
}

function drawCandles(id,W,H,baseP,up){
  const cv=document.getElementById(id);if(!cv)return;
  const cx=cv.getContext('2d');cx.clearRect(0,0,W,H);
  cx.strokeStyle='rgba(255,255,255,.03)';cx.lineWidth=.5;
  for(let i=1;i<5;i++){cx.beginPath();cx.moveTo(0,i*H/5);cx.lineTo(W,i*H/5);cx.stroke();}
  let p=baseP,cd=[];
  for(let i=0;i<52;i++){const o=p,r=p*.008,h=o+Math.random()*r,l=o-Math.random()*r,c=o+(Math.random()-.5+(up?.002:-.002))*r;p=c;cd.push({o,h,l,c,b:c>=o});}
  const mn=Math.min(...cd.map(x=>x.l)),mx=Math.max(...cd.map(x=>x.h)),rng=mx-mn||1;
  const py=v=>10+(mx-v)/rng*(H-20),cw=6,gap=2;
  cd.forEach((c,i)=>{
    const x=4+i*(cw+gap),col=c.b?'#17c3a8':'#f0627a';
    cx.strokeStyle=col;cx.lineWidth=1;cx.beginPath();cx.moveTo(x+cw/2,py(c.h));cx.lineTo(x+cw/2,py(c.l));cx.stroke();
    cx.fillStyle=col;const t=py(Math.max(c.o,c.c)),b=py(Math.min(c.o,c.c));cx.fillRect(x,t,cw,Math.max(1,b-t));
    const vl=.3+Math.random()*.7;cx.fillStyle=c.b?'rgba(23,195,168,.18)':'rgba(240,98,122,.18)';cx.fillRect(x,H-vl*30,cw,vl*30);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WATCHLIST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setWTabActive(){
  ['mylist','scanner','recent'].forEach((t,i)=>document.getElementById('wt'+i)?.classList.toggle('act',t===wTab));
}
function setWTab(t){wTab=t;setWTabActive();buildWL();}
function buildWL(){
  if(wTab==='mylist') document.getElementById('wlC').innerHTML=buildMyList();
  else if(wTab==='scanner') document.getElementById('wlC').innerHTML=buildScanner();
  else document.getElementById('wlC').innerHTML=buildRecent();
}
function buildMyList(){
  const lists=Object.keys(MYLISTS);
  const syms=MYLISTS[listTab]||[];
  const rows=STOCKS.filter(x=>syms.includes(x.s));
  return `
  <div class="list-tabs">
    ${lists.map(l=>`<div class="ltab ${l===listTab?'act':''}" onclick="listTab='${l}';buildWL()">${l}</div>`).join('')}
    <div class="ltab-ic">‚ãÆ</div><div class="ltab-ic">+</div><div class="ltab-ic">‚â°</div>
  </div>
  <div class="col-hdr"><span style="flex:1;">Stock</span><span style="width:130px;text-align:right;">LTP / Change</span></div>
  ${(rows.length?rows:STOCKS.slice(0,5)).map(s=>wRow(s)).join('')}
  <button class="add-stock" onclick="notif('üîç','Search','Add stocks to ${listTab} list')">
    <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    Search & Add
  </button>
  <div style="height:20px;"></div>`;
}
function wRow(s){
  const up=s.c>=0;
  return `<div class="wl-row" onclick="openDet('${s.s}')">
    <div class="wl-lf"><div class="wl-nm">${s.n||s.s}</div><div class="wl-sb">NSE</div></div>
    <div class="wl-rt"><div class="wl-pr">${s.p.toLocaleString('en-IN',{maximumFractionDigits:2})}</div><div class="wl-ch ${up?'up':'dn'}">${up?'+':''}${s.c.toFixed(2)} (${Math.abs(s.pct||s.c).toFixed(2)}%)</div></div>
  </div>`;
}
function buildScanner(){
  const tabs=[
    {id:'gainers',lbl:'Gainers'},{id:'losers',lbl:'Losers'},
    {id:'volume',lbl:'Volume Shocker'},{id:'shortcover',lbl:'Short Covering'},
    {id:'shortbuild',lbl:'Short Buildup'},{id:'longbuild',lbl:'Long Buildup'},
    {id:'longunwind',lbl:'Long Unwinding'},{id:'rsi_os',lbl:'RSI Oversold'},{id:'rsi_ob',lbl:'RSI Overbought'},
  ];
  const data=SCANS[scanTab]||SCANS.gainers;
  const isOI=['shortcover','shortbuild','longbuild','longunwind'].includes(scanTab);
  const isBull=['gainers','shortcover','longbuild','rsi_ob'].includes(scanTab);
  return `
  <div class="scan-tabs">
    ${tabs.map(t=>`<div class="stab ${t.id===scanTab?'act':''}" onclick="scanTab='${t.id}';buildWL()">${t.lbl}</div>`).join('')}
  </div>
  <div class="idx-filter"><span class="ifl">Index</span><div class="ifd">NIFTY 500 ‚ñº</div></div>
  <div class="col-hdr">
    <span style="flex:1;">STOCKS</span>
    ${isOI?'<span style="width:115px;text-align:right;padding-right:6px;">TOTAL OI (L)</span>':''}
    <span style="width:100px;text-align:right;">LTP (CHG%)</span>
  </div>
  ${data.map(s=>{
    const up=s.c>=0;
    return `<div class="wl-row" onclick="openDet('${s.s}')">
      <div class="wl-lf"><div class="wl-nm">${s.n||s.s}</div><div class="wl-sb">NSE</div></div>
      ${isOI?`<div class="wl-oi"><div class="wl-ov ${isBull?'up':'dn'}">${s.oiL}</div><div class="wl-op ${isBull?'up':'dn'}">(${s.oi})</div></div>`:''}
      <div class="wl-rt"><div class="wl-pr">${(s.p||s.ltp||0).toFixed(2)}</div><div class="wl-ch ${up?'up':'dn'}">${up?'+':''}${s.c.toFixed(2)}(${Math.abs(s.pct||s.c).toFixed(2)}%)</div></div>
    </div>`;
  }).join('')}
  <div style="height:20px;"></div>`;
}
function buildRecent(){
  return`<div style="padding:10px 16px 4px;font-size:11px;color:#8b949e;text-transform:uppercase;letter-spacing:.5px;font-weight:500;">Recently Viewed</div>
  ${STOCKS.slice(0,6).map(s=>wRow(s)).join('')}`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STOCK DETAIL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openDet(sym){
  curS=STOCKS.find(x=>x.s===sym)||STOCKS[0];
  const up=curS.c>=0;
  document.getElementById('dSym').textContent=curS.s;
  document.getElementById('dPrice').textContent='‚Çπ'+curS.p.toLocaleString('en-IN',{maximumFractionDigits:2});
  document.getElementById('dChg').className='det-chg '+(up?'up':'dn');
  document.getElementById('dChg').textContent=(up?'+':'')+curS.c.toFixed(2)+' ('+Math.abs(curS.pct).toFixed(2)+'%)';
  goTo('detail');
  document.querySelectorAll('.dtab').forEach((t,i)=>{t.classList.toggle('act',i===0);});
  dTab='chart';buildDetC('chart');
}
function setDTab(el,t){dTab=t;document.querySelectorAll('.dtab').forEach(x=>x.classList.remove('act'));el.classList.add('act');buildDetC(t);}
function buildDetC(t){
  const s=curS,up=s.c>=0;
  let h='';
  if(t==='chart'){
    h=`<canvas id="dChart" width="430" height="220" style="display:block;"></canvas>
    <div class="chart-ctrl">
      <div class="cc"><div class="cc-i">‚Üî</div><div class="cc-l">Range</div></div>
      <div class="cc"><div class="cc-t">1 min</div><div class="cc-l">Interval</div></div>
      <div class="cc"><div class="cc-i" style="font-style:italic;font-weight:700;">f</div><div class="cc-l">Indicators</div></div>
      <div class="cc"><div class="cc-i">‚úèÔ∏è</div><div class="cc-l">Drawings</div></div>
      <div class="cc"><div class="cc-i">‚öôÔ∏è</div><div class="cc-l">Settings</div></div>
    </div>
    <div class="fo-row" style="margin-top:10px;">
      <button class="fo-btn" onclick="notif('üìä','Futures','${s.s} Futures ‚Äî Dec Expiry')"><svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Futures</button>
      <button class="fo-btn fo-opt" onclick="notif('üîó','Option Chain','${s.s} Option Chain')"><svg width="17" height="17" fill="none" stroke="#fff" stroke-width="2" viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>Option Chain</button>
    </div>
    <div class="lsnap">
      <div class="lsnap-t">Live snapshot</div>
      <div class="snap-row">
        <div class="snap-lbl">
          <div><div class="snap-lo">Today's low</div><div class="snap-lv">‚Çπ${(s.p*.992).toFixed(2)}</div></div>
          <div style="text-align:right;"><div class="snap-lo">Today's high</div><div class="snap-lv">‚Çπ${(s.p*1.006).toFixed(2)}</div></div>
        </div>
        <div class="snap-bar"><div class="snap-fill" style="width:42%;"></div><div class="snap-dot" style="left:42%;"></div></div>
      </div>
      <div class="snap-row">
        <div class="snap-lbl">
          <div><div class="snap-lo">52 W Low</div><div class="snap-lv">‚Çπ${(s.p*.74).toFixed(2)}</div></div>
          <div style="text-align:right;"><div class="snap-lo">52 W High</div><div class="snap-lv">‚Çπ${(s.p*1.18).toFixed(2)}</div></div>
        </div>
        <div class="snap-bar"><div class="snap-fill" style="width:58%;background:#6b88ff;"></div><div class="snap-dot" style="left:58%;border-color:#6b88ff;"></div></div>
      </div>
    </div>
    <div class="scalper" onclick="notif('‚ö°','Options Scalper','${s.s} scalping signals')">
      <div><div class="sc-t">Enter Options Scalper ‚Üí</div><div class="sc-s">Live signals ¬∑ ${s.sec}</div></div>
    </div>
    <div style="height:80px;"></div>`;
  } else if(t==='options'){
    h=`<div style="padding:16px;">
      <div style="font-size:17px;font-weight:600;color:#fff;margin-bottom:14px;">Put Call Ratio (PCR)</div>
      <div class="pcr-legend"><div class="pcr-leg"><div class="pcr-dot" style="background:#6b88ff;"></div>Price</div><div class="pcr-leg"><div class="pcr-dot" style="background:#f59e0b;"></div>PCR</div><div class="pcr-exp">Expiry: 30 Mar</div></div>
      <div class="pcr-wrap"><canvas id="pcrC" width="360" height="110"></canvas></div>
      <div style="font-size:17px;font-weight:600;color:#fff;margin-bottom:14px;">ATM IV</div>
      <div class="pcr-legend"><div class="pcr-leg"><div class="pcr-dot" style="background:#6b88ff;"></div>Price</div><div class="pcr-leg"><div class="pcr-dot" style="background:#f59e0b;"></div>ATM IV</div><div class="pcr-exp">Expiry: 30 Mar</div></div>
      <div class="pcr-wrap"><canvas id="ivC" width="360" height="110"></canvas></div>
    </div><div style="height:80px;"></div>`;
  } else if(t==='fundamentals'){
    h=`<div style="padding:16px;">
      <div style="font-size:17px;font-weight:600;color:#fff;margin-bottom:14px;">${s.n}</div>
      <div class="fund-grid">
        <div class="fc"><div class="fc-l">Market Cap</div><div class="fc-v">‚Çπ${(s.p*670/1000).toFixed(0)}K Cr</div></div>
        <div class="fc"><div class="fc-l">P/E Ratio</div><div class="fc-v">${(18+Math.random()*12).toFixed(1)}</div></div>
        <div class="fc"><div class="fc-l">EPS</div><div class="fc-v">‚Çπ${(s.p/22).toFixed(1)}</div></div>
        <div class="fc"><div class="fc-l">Book Value</div><div class="fc-v">‚Çπ${(s.p*.6).toFixed(0)}</div></div>
        <div class="fc"><div class="fc-l">Dividend Yield</div><div class="fc-v">1.2%</div></div>
        <div class="fc"><div class="fc-l">ROE</div><div class="fc-v">18.4%</div></div>
        <div class="fc"><div class="fc-l">Debt/Equity</div><div class="fc-v">0.42</div></div>
        <div class="fc"><div class="fc-l">52W High</div><div class="fc-v">‚Çπ${(s.p*1.18).toFixed(0)}</div></div>
      </div>
      <div style="font-size:17px;font-weight:600;color:#fff;margin-bottom:14px;">Quarterly Results</div>
      <div class="fund-grid">
        <div class="fc"><div class="fc-l">Revenue Q3 (Cr)</div><div class="fc-v">‚Çπ${(s.p*2.4).toFixed(0)}</div></div>
        <div class="fc"><div class="fc-l">Net Profit Q3 (Cr)</div><div class="fc-v">‚Çπ${(s.p*.4).toFixed(0)}</div></div>
        <div class="fc"><div class="fc-l">YoY Growth</div><div class="fc-v up">+12.4%</div></div>
        <div class="fc"><div class="fc-l">QoQ Growth</div><div class="fc-v up">+3.8%</div></div>
      </div>
    </div>
    <div style="padding:0 16px;">
      <div style="font-size:16px;font-weight:600;color:#fff;margin-bottom:12px;">Similar Stocks</div>
      <div style="font-size:14px;color:#8b949e;margin-bottom:10px;">${s.n} operates in ${s.sec} industry.</div>
      <div class="sim-cards">
        ${STOCKS.filter(x=>x.sec===s.sec&&x.s!==s.s).slice(0,4).map(x=>`<div class="sim-card" onclick="openDet('${x.s}')"><div class="sim-nm">${x.n}</div><div class="sim-pr">${x.p.toFixed(2)}</div><div class="sim-ch ${x.c>=0?'up':'dn'}">${x.c>=0?'+':''}${x.c.toFixed(2)} (${Math.abs(x.pct).toFixed(2)}%)</div></div>`).join('')}
      </div>
    </div>
    <div style="height:80px;"></div>`;
  } else {
    h=`<div style="padding:16px;">
      <div style="font-size:17px;font-weight:600;color:#fff;margin-bottom:14px;">Shareholding Pattern</div>
      <div style="background:#131820;border-radius:12px;overflow:hidden;">
        ${[['Promoters','52.4%','#17c3a8'],['FII','24.8%','#6b88ff'],['DII','14.2%','#f59e0b'],['Retail','8.6%','#f0627a']].map(r=>`
        <div style="display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid #0d1017;">
          <div style="width:11px;height:11px;border-radius:50%;background:${r[2]};margin-right:10px;"></div>
          <div style="flex:1;font-size:15px;font-weight:500;color:#fff;">${r[0]}</div>
          <div style="font-size:15px;font-weight:700;color:#fff;">${r[1]}</div>
        </div>`).join('')}
      </div>
      <div style="font-size:16px;font-weight:600;color:#fff;margin:16px 0 10px;">Mutual Fund Holdings</div>
      <div style="background:#131820;border-radius:12px;overflow:hidden;">
        ${[['Motilal Oswal Midcap Fund','1,145 (3.3%)'],['Mirae Asset Large & Midcap Fund','609 (1.4%)'],['Invesco India Midcap Fund','482 (4.8%)'],['Mirae Asset Midcap Fund','420 (2.4%)'],['DSP Midcap Fund','375 (2.0%)']].map(r=>`
        <div style="display:flex;padding:12px 16px;border-bottom:1px solid #0d1017;"><span style="flex:1;font-size:14px;color:#fff;">${r[0]}</span><span style="font-size:14px;font-weight:600;color:#8b949e;">${r[1]}</span></div>`).join('')}
      </div>
    </div>
    <div style="height:80px;"></div>`;
  }
  document.getElementById('detC').innerHTML=h;
  if(t==='chart') setTimeout(()=>drawCandles('dChart',430,220,s.p,up),40);
  if(t==='options') setTimeout(()=>{
    ['pcrC','ivC'].forEach(id=>{
      const cv=document.getElementById(id);if(!cv)return;
      const cx=cv.getContext('2d'),W=360,H=110;cx.clearRect(0,0,W,H);
      [['#6b88ff',.45],['#f59e0b',.55]].forEach(([col,b])=>{
        let y=H*.5,pts=[];
        for(let x=0;x<=W;x+=W/35){y+=(Math.random()-.5+b*.08)*H*.16;y=Math.max(H*.08,Math.min(H*.92,y));pts.push([x,y]);}
        cx.strokeStyle=col;cx.lineWidth=1.5;cx.beginPath();pts.forEach(([x,y],i)=>i?cx.lineTo(x,y):cx.moveTo(x,y));cx.stroke();
      });
    });
  },50);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ORDERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildOrders(){
  const saved=JSON.parse(localStorage.getItem('be_orders')||'[]');
  document.getElementById('ordersC').innerHTML=saved.length?saved.map(o=>{
    const col=o.status==='EXECUTED'?'#17c3a8':'#f0627a';
    return`<div class="ord-row"><div class="or-l"><div class="or-sym">${o.sym} <span style="font-size:12px;font-weight:600;color:${o.type==='BUY'?'#17c3a8':'#f0627a'};">${o.type}</span></div><div class="or-det">${o.qty} qty ¬∑ ‚Çπ${Number(o.price).toLocaleString('en-IN')} ¬∑ ${o.time}</div></div><div class="or-r"><div class="or-st" style="color:${col};">${o.status}</div><div class="or-amt">‚Çπ${(o.qty*o.price).toLocaleString('en-IN',{maximumFractionDigits:0})}</div></div></div>`;
  }).join(''):`<div class="empty-st"><svg width="60" height="60" fill="none" stroke="currentColor" stroke-width="1.2" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="2"/></svg><div class="empty-t">No orders yet</div><div>Place a trade to see it here</div></div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PORTFOLIO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildPF(){
  const tv=HOLDS.reduce((a,h)=>a+(STOCKS.find(x=>x.s===h.s)?.p||h.avg)*h.qty,0);
  const ti=HOLDS.reduce((a,h)=>a+h.qty*h.avg,0);
  const tp=tv-ti,tpp=tp/ti*100;
  document.getElementById('pfC').innerHTML=`
  <div class="pf-sum">
    <div class="pf-lbl">Total investment value</div>
    <div class="pf-val">‚Çπ${tv.toLocaleString('en-IN',{maximumFractionDigits:0})}</div>
    <div class="pf-ret ${tp>=0?'up':'dn'}">${tp>=0?'‚ñ≤':'‚ñº'} ‚Çπ${Math.abs(tp).toLocaleString('en-IN',{maximumFractionDigits:0})} (${Math.abs(tpp).toFixed(2)}%) Total returns</div>
    <div class="pf-grid">
      <div class="pf-cell"><div class="pf-cl">Invested</div><div class="pf-cv">‚Çπ${ti.toLocaleString('en-IN',{maximumFractionDigits:0})}</div></div>
      <div class="pf-cell"><div class="pf-cl">Today's P&L</div><div class="pf-cv up">+‚Çπ4,284</div></div>
      <div class="pf-cell"><div class="pf-cl">1D Returns</div><div class="pf-cv up">+0.82%</div></div>
      <div class="pf-cell"><div class="pf-cl">XIRR</div><div class="pf-cv up">28.4%</div></div>
    </div>
  </div>
  <div style="padding:14px 16px 6px;font-size:12px;color:#8b949e;font-weight:500;text-transform:uppercase;letter-spacing:.4px;">Holdings</div>
  ${HOLDS.map(h=>{
    const st=STOCKS.find(x=>x.s===h.s),ltp=st?st.p:h.avg,pnl=(ltp-h.avg)*h.qty,pp=(ltp-h.avg)/h.avg*100,pos=pnl>=0;
    return`<div class="hold-row" onclick="openDet('${h.s}')"><div class="h-ico" style="background:${h.col}1a;color:${h.col};">${h.s.slice(0,2)}</div><div class="h-l"><div class="h-nm">${h.s}</div><div class="h-dt">${h.qty} qty ¬∑ Avg ‚Çπ${h.avg.toLocaleString()}</div></div><div class="h-r"><div class="h-pnl ${pos?'up':'dn'}">${pos?'+':''}‚Çπ${Math.abs(pnl).toLocaleString('en-IN',{maximumFractionDigits:0})}</div><div class="h-pct ${pos?'up':'dn'}">${pos?'+':''}${pp.toFixed(2)}%</div></div></div>`;
  }).join('')}<div style="height:20px;"></div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildProf(){
  document.getElementById('profC').innerHTML=`
  <div class="prof-pg">
    <div class="prof-av">A</div>
    <div class="prof-nm">AMIT KUMAR</div>
    <div class="prof-lk">Account details ‚Ä∫</div>
    <div class="prof-cards">
      <div class="pc" onclick="notif('‚Çπ','Funds','Available: ‚Çπ1,24,500 ¬∑ Used: ‚Çπ4,24,830')"><div class="pc-ic">‚Çπ</div><div class="pc-v">‚Çπ1.24L</div><div class="pc-l">Funds</div></div>
      <div class="pc" onclick="notif('üéß','Support','Connecting to live support...')"><div class="pc-ic">üéß</div><div class="pc-v">Help</div><div class="pc-l">Live Support</div></div>
      <div class="pc" onclick="notif('üìÖ','P&L Calendar','Daily: +‚Çπ4,284 ¬∑ Monthly: +‚Çπ28,420')"><div class="pc-ic">üìÖ</div><div class="pc-v">P&L</div><div class="pc-l">Calendar</div></div>
    </div>
    <div class="sec-card">
      <div class="sec-t">Trader's Controls</div>
      <div class="mr" onclick="notif('üõë','Kill Switch','All segments disabled for today')"><div class="mr-ic">üõë</div><div class="mr-l"><div class="mr-t">Kill Switch</div><div class="mr-s">Disable trading segments for the day</div></div><div class="mr-arr">‚Ä∫</div></div>
      <div class="mr" onclick="notif('‚öôÔ∏è','Order Defaults','Auto SL/TP configured')"><div class="mr-ic">‚öôÔ∏è</div><div class="mr-l"><div class="mr-t">Order Defaults<span class="badge">New</span></div><div class="mr-s">Set auto SL/TP, default order types</div></div><div class="mr-arr">‚Ä∫</div></div>
    </div>
    <div class="sec-card">
      <div class="mr" onclick="notif('üìÑ','Statements','P&L, Tax, Ledger...')"><div class="mr-ic">üìÑ</div><div class="mr-l"><div class="mr-t">Statements</div><div class="mr-s">P&L, Tax, Ledger, Contract Note</div></div><div class="mr-arr">‚Ä∫</div></div>
      <div class="mr" onclick="notif('üè¶','Bank','Linked: SBI XXXX4521')"><div class="mr-ic">üè¶</div><div class="mr-l"><div class="mr-t">Bank Accounts</div></div><div class="mr-arr">‚Ä∫</div></div>
      <div class="mr" onclick="notif('üí∞','Pricing','‚Çπ0 delivery ¬∑ ‚Çπ20 F&O flat')"><div class="mr-ic">üí∞</div><div class="mr-l"><div class="mr-t">View pricing details</div></div><div class="mr-arr">‚Ä∫</div></div>
      <div class="mr" onclick="notif('üìñ','Learn','Opening tutorial...')"><div class="mr-ic">üìñ</div><div class="mr-l"><div class="mr-t">Learn how to use Bulls Eye</div></div><div class="mr-arr">‚Ä∫</div></div>
      <div class="mr" onclick="notif('üí¨','Feedback','Thanks for your feedback!')"><div class="mr-ic">üí¨</div><div class="mr-l"><div class="mr-t">Give us your feedback</div></div><div class="mr-arr">‚Ä∫</div></div>
    </div>
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ORDER OVERLAY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openOrder(t){
  oType=t;
  document.getElementById('ovSym').textContent=curS.s;
  document.getElementById('ovMPr').textContent='‚Çπ'+curS.p.toLocaleString('en-IN',{maximumFractionDigits:2})+' ¬∑ NSE';
  document.getElementById('ovPr').value=curS.p.toFixed(0);
  setOT(t);
  document.getElementById('ov').classList.add('on');
}
function closeOrder(){document.getElementById('ov').classList.remove('on');}
function setOT(t){
  oType=t;
  document.getElementById('ovB').className='ov-tt '+(t==='BUY'?'b-a':'');
  document.getElementById('ovS').className='ov-tt '+(t==='SELL'?'s-a':'');
  document.getElementById('ovBtn').className=t==='BUY'?'ov-submit-buy':'ov-submit-sell';
  document.getElementById('ovBtn').textContent=`‚ö° Confirm ${t}`;
  calcMg();
}
function oS(el){el.parentElement.querySelectorAll('.ov-sb').forEach(b=>b.classList.remove('act'));el.classList.add('act');}
function calcMg(){
  const q=+document.getElementById('ovQt').value||1,p=+document.getElementById('ovPr').value||curS.p;
  document.getElementById('ovMg').textContent='‚Çπ'+(q*p*.2).toLocaleString('en-IN',{maximumFractionDigits:0});
}
function placeOrder(){
  const qty=+document.getElementById('ovQt').value,pr=+document.getElementById('ovPr').value;
  const h=JSON.parse(localStorage.getItem('be_orders')||'[]');
  h.unshift({sym:curS.s,type:oType,qty,price:pr,status:'EXECUTED',time:new Date().toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'})});
  localStorage.setItem('be_orders',JSON.stringify(h.slice(0,50)));
  closeOrder();
  notif(oType==='BUY'?'‚úÖ':'üìâ',`${oType} Order Placed!`,`${qty} ${curS.s} @ ‚Çπ${pr.toLocaleString()} ¬∑ Confirmed`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NOTIFICATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let nT;
function notif(ico,title,body){
  document.getElementById('nIco').textContent=ico;
  document.getElementById('nTit').textContent=title;
  document.getElementById('nBod').textContent=body;
  const el=document.getElementById('notif');
  el.classList.add('on');
  clearTimeout(nT);
  nT=setTimeout(()=>el.classList.remove('on'),3200);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LIVE UPDATES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
setInterval(()=>{
  STOCKS.forEach(s=>{const d=(Math.random()-.499)*s.p*.0006;s.p=Math.max(1,s.p+d);});
  IDXS.forEach(x=>{x.p=Math.max(100,x.p+(Math.random()-.499)*x.p*.0004);});
},3500);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VOICE + ALERT + NOTIFICATION SYSTEM ‚Äî FULL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ PRICE ALERTS STORAGE ‚îÄ‚îÄ
let priceAlerts = JSON.parse(localStorage.getItem('be_alerts')||'[]');
// {id, sym, targetPrice, type:'above'|'below', active:true, created}

// ‚îÄ‚îÄ SPEECH SYNTHESIS (Voice Output) ‚îÄ‚îÄ
function speak(text){
  if(!('speechSynthesis' in window)) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'hi-IN';
  u.rate = 0.95;
  u.pitch = 1.1;
  u.volume = 1;
  // Try Hindi voice, fallback to any
  const voices = window.speechSynthesis.getVoices();
  const hi = voices.find(v=>v.lang.startsWith('hi'))||voices.find(v=>v.lang.startsWith('en-IN'))||voices[0];
  if(hi) u.voice = hi;
  window.speechSynthesis.speak(u);
}

// ‚îÄ‚îÄ ALARM SOUND ‚îÄ‚îÄ
let alarmCtx = null;
function playAlarm(type='alert'){
  try {
    alarmCtx = new (window.AudioContext||window.webkitAudioContext)();
    const patterns = {
      alert:  [[523,0.1],[0,0.05],[523,0.1],[0,0.05],[659,0.3]],
      buy:    [[392,0.08],[523,0.08],[659,0.08],[784,0.3]],
      sell:   [[784,0.08],[659,0.08],[523,0.08],[392,0.3]],
      urgent: [[880,0.1],[0,0.05],[880,0.1],[0,0.05],[880,0.1],[0,0.05],[1047,0.5]],
    };
    let t = alarmCtx.currentTime;
    (patterns[type]||patterns.alert).forEach(([freq,dur])=>{
      if(freq>0){
        const osc=alarmCtx.createOscillator();
        const gain=alarmCtx.createGain();
        osc.connect(gain); gain.connect(alarmCtx.destination);
        osc.frequency.value=freq; osc.type='sine';
        gain.gain.setValueAtTime(0.4,t);
        gain.gain.exponentialRampToValueAtTime(0.001,t+dur);
        osc.start(t); osc.stop(t+dur);
      }
      t+=dur+(freq>0?0.02:0);
    });
  } catch(e){}
}

// ‚îÄ‚îÄ PHONE CALL SIMULATION ‚îÄ‚îÄ
function makeCall(sym, price){
  // Show full-screen call UI
  const overlay = document.createElement('div');
  overlay.id = 'callOverlay';
  overlay.style.cssText = 'position:fixed;inset:0;background:#0a0a0a;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;';
  overlay.innerHTML = `
    <div style="text-align:center;padding:40px 20px;">
      <div style="font-size:18px;color:#8b949e;margin-bottom:8px;font-family:Inter,sans-serif;">Bulls Eye Alert</div>
      <div style="font-size:32px;font-weight:700;color:#fff;margin-bottom:6px;font-family:Inter,sans-serif;">${sym}</div>
      <div style="font-size:22px;font-weight:600;color:#17c3a8;margin-bottom:6px;font-family:Inter,sans-serif;">‚Çπ${price.toLocaleString('en-IN')}</div>
      <div style="font-size:15px;color:#8b949e;margin-bottom:50px;font-family:Inter,sans-serif;">üéØ Target Price Reached!</div>
      <div style="width:80px;height:80px;border-radius:50%;background:#17c3a8;display:flex;align-items:center;justify-content:center;margin:0 auto 40px;animation:pulse-ring 1s infinite;">
        <span style="font-size:36px;">üìû</span>
      </div>
      <div style="font-size:13px;color:#555;margin-bottom:40px;font-family:Inter,sans-serif;">Bulls Eye ‚Äî Price Alert Notification</div>
      <div style="display:flex;gap:40px;justify-content:center;">
        <div style="text-align:center;cursor:pointer;" onclick="endCall()">
          <div style="width:64px;height:64px;border-radius:50%;background:#f0627a;display:flex;align-items:center;justify-content:center;margin:0 auto 8px;font-size:24px;">üìµ</div>
          <span style="font-size:13px;color:#fff;font-family:Inter,sans-serif;">Dismiss</span>
        </div>
        <div style="text-align:center;cursor:pointer;" onclick="endCall();openDet('${sym}')">
          <div style="width:64px;height:64px;border-radius:50%;background:#17c3a8;display:flex;align-items:center;justify-content:center;margin:0 auto 8px;font-size:24px;">üìà</div>
          <span style="font-size:13px;color:#fff;font-family:Inter,sans-serif;">View Chart</span>
        </div>
      </div>
    </div>`;
  document.body.appendChild(overlay);
  // Play urgent alarm
  playAlarm('urgent');
  // Vibrate
  if(navigator.vibrate) navigator.vibrate([500,200,500,200,500,200,1000]);
  // Speak alert
  setTimeout(()=>speak(`Alert! ${sym} ka target price ‚Çπ${price} reach ho gaya. Abhi action lo!`), 300);
  // Auto close after 30s
  setTimeout(()=>endCall(), 30000);
}
function endCall(){
  window.speechSynthesis?.cancel();
  document.getElementById('callOverlay')?.remove();
}

// ‚îÄ‚îÄ PRICE ALERT CHECKER (runs every 3 sec) ‚îÄ‚îÄ
function checkAlerts(){
  if(!priceAlerts.length) return;
  priceAlerts.forEach((alert,i)=>{
    if(!alert.active) return;
    const st = STOCKS.find(s=>s.s===alert.sym);
    if(!st) return;
    const hit = alert.type==='above' ? st.p >= alert.targetPrice : st.p <= alert.targetPrice;
    if(hit){
      priceAlerts[i].active = false;
      localStorage.setItem('be_alerts', JSON.stringify(priceAlerts));
      // Trigger ALL notifications
      triggerAlert(alert.sym, st.p, alert.targetPrice, alert.type);
    }
  });
}
function triggerAlert(sym, ltp, target, type){
  const up = type==='above';
  // 1. Screen notification
  notif('üö®', `${sym} Alert Triggered!`, `‚Çπ${ltp.toFixed(2)} ${up?'crossed above':'fell below'} ‚Çπ${target}`);
  // 2. Browser notification
  if(Notification.permission==='granted'){
    new Notification(`üö® Bulls Eye ‚Äî ${sym} Alert!`,{
      body:`Price ${up?'reached':'fell to'} ‚Çπ${ltp.toFixed(2)} (Target: ‚Çπ${target})`,
      icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="%2317c3a8"/><text y=".9em" font-size="90" x="10">üéØ</text></svg>'
    });
  }
  // 3. Call screen + alarm
  setTimeout(()=>makeCall(sym, ltp), 500);
}
setInterval(checkAlerts, 3000);

// ‚îÄ‚îÄ REQUEST PERMISSIONS ‚îÄ‚îÄ
function reqPermissions(){
  if('Notification' in window && Notification.permission==='default'){
    Notification.requestPermission();
  }
}
setTimeout(reqPermissions, 2000);

// ‚îÄ‚îÄ ADD PRICE ALERT ‚îÄ‚îÄ
function addPriceAlert(sym, targetPrice, type){
  priceAlerts.push({id:Date.now(), sym, targetPrice:+targetPrice, type, active:true, created:new Date().toLocaleTimeString()});
  localStorage.setItem('be_alerts', JSON.stringify(priceAlerts));
  playAlarm('alert');
  speak(`${sym} ka ${type==='above'?'upar':'neeche'} alert ‚Çπ${targetPrice} pe set ho gaya`);
  notif('‚úÖ',`Alert Set ‚Äî ${sym}`,`‚Çπ${targetPrice} ${type==='above'?'cross hone par':'neeche aane par'} call aayegi`);
  renderAlertsPanel();
}

// ‚îÄ‚îÄ ALERTS PANEL (show active alerts) ‚îÄ‚îÄ
function renderAlertsPanel(){
  const panel = document.getElementById('alertsPanel');
  // update badge
  const active = priceAlerts.filter(a=>a.active);
  const badge = document.getElementById('alertBadge');
  if(badge) badge.style.display = active.length ? 'block' : 'none';
  if(!panel) return;
  panel.innerHTML = active.length ? active.map(a=>{
    const st = STOCKS.find(s=>s.s===a.sym);
    const ltp = st ? st.p.toFixed(2) : '---';
    const pct = st ? ((st.p - a.targetPrice)/a.targetPrice*100).toFixed(2) : '';
    const gap = st ? (a.type==='above' ? a.targetPrice - st.p : st.p - a.targetPrice) : 0;
    return `
    <div style="display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid #0d1017;">
      <div style="flex:1;">
        <div style="font-size:16px;font-weight:700;color:#fff;">${a.sym} <span style="font-size:11px;font-weight:600;color:${a.type==='above'?'#17c3a8':'#f0627a'};background:${a.type==='above'?'#17c3a81a':'#f0627a1a'};padding:2px 7px;border-radius:6px;">${a.type==='above'?'‚Üë ABOVE':'‚Üì BELOW'}</span></div>
        <div style="font-size:13px;color:#8b949e;margin-top:3px;">Target: <b style="color:#fff;">‚Çπ${a.targetPrice.toLocaleString('en-IN')}</b> ¬∑ LTP: <b style="color:#fff;">‚Çπ${ltp}</b></div>
        <div style="font-size:12px;color:#8b949e;margin-top:2px;">${gap>0?`‚Çπ${Math.abs(gap).toFixed(2)} ${a.type==='above'?'aur upar jaana hai':'aur neeche aana hai'}`:'‚úÖ Target zone pe hai!'}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end;">
        <div style="font-size:12px;color:#17c3a8;font-weight:600;">üîî ACTIVE</div>
        <button onclick="triggerAlert('${a.sym}',${st?.p||a.targetPrice},${a.targetPrice},'${a.type}')" style="background:#f59e0b1a;border:1px solid #f59e0b40;color:#f59e0b;border-radius:6px;padding:3px 8px;cursor:pointer;font-size:11px;font-weight:600;">Test üîä</button>
        <button onclick="deleteAlert(${a.id})" style="background:#f0627a1a;border:1px solid #f0627a40;color:#f0627a;border-radius:6px;padding:3px 8px;cursor:pointer;font-size:11px;">‚úï Delete</button>
      </div>
    </div>`}).join('') :
    `<div style="text-align:center;padding:40px 20px;color:#8b949e;">
      <div style="font-size:40px;margin-bottom:16px;">üîî</div>
      <div style="font-size:17px;font-weight:600;color:#fff;margin-bottom:8px;">Koi active alert nahi</div>
      <div style="font-size:14px;line-height:1.8;">Voice se set karo:<br><b style="color:#17c3a8;">"Alert HDFC at 1700"</b><br><b style="color:#17c3a8;">"Reliance above 2900"</b><br><b style="color:#17c3a8;">"TCS below 3800"</b></div>
    </div>`;
}
function deleteAlert(id){
  priceAlerts = priceAlerts.filter(a=>a.id!==id);
  localStorage.setItem('be_alerts', JSON.stringify(priceAlerts));
  renderAlertsPanel();
  notif('üóëÔ∏è','Alert Deleted','Alert remove kar diya gaya');
}

// ‚îÄ‚îÄ VOICE SYSTEM ‚îÄ‚îÄ
let isListening=false, recognition=null, voiceState='idle', pendingVoiceAction={};

function toggleVoice(){
  const btn=document.getElementById('voiceBtn');
  if(isListening){stopVoice();return;}
  showVoiceUI();
  if('webkitSpeechRecognition' in window||'SpeechRecognition' in window){
    startListening();
  } else {
    // Demo mode - show modal with manual input
    notif('üéôÔ∏è','Voice Demo Mode','Koi SR support nahi ‚Äî demo chalega');
    setTimeout(()=>{demoVoice();},1500);
  }
}

function startListening(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  recognition=new SR();
  recognition.lang='hi-IN';
  recognition.interimResults=true;
  recognition.continuous=false;
  recognition.maxAlternatives=3;
  recognition.onstart=()=>{
    isListening=true;
    document.getElementById('voiceBtn').classList.add('listening');
    updateVoiceUI('Listening... Bolte raho üéôÔ∏è','#17c3a8');
  };
  recognition.onresult=(e)=>{
    let interim='', final='';
    for(let i=e.resultIndex;i<e.results.length;i++){
      if(e.results[i].isFinal) final+=e.results[i][0].transcript;
      else interim+=e.results[i][0].transcript;
    }
    if(interim) updateVoiceUI('"'+interim+'"','#f59e0b');
    if(final){ stopVoice(); processVoice(final.toLowerCase().trim()); }
  };
  recognition.onerror=(e)=>{stopVoice();notif('‚ùå','Voice Error',e.error==='not-allowed'?'Mic permission do':'Dobara try karo');};
  recognition.onend=()=>stopVoice();
  recognition.start();
}

function stopVoice(){
  isListening=false;
  document.getElementById('voiceBtn')?.classList.remove('listening');
  if(recognition){ try{recognition.stop();}catch(e){} }
  hideVoiceUI();
}

// ‚îÄ‚îÄ VOICE UI OVERLAY ‚îÄ‚îÄ
function showVoiceUI(){
  if(document.getElementById('voiceUI')) return;
  const d=document.createElement('div');
  d.id='voiceUI';
  d.style.cssText='position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#131820;border:1px solid #1a1f2e;border-radius:20px;padding:16px 20px;z-index:600;width:88%;max-width:380px;box-shadow:0 8px 40px rgba(0,0,0,.7);';
  d.innerHTML=`
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
      <div style="width:10px;height:10px;border-radius:50%;background:#17c3a8;animation:blink 1s infinite;" id="voiceDot"></div>
      <div style="font-size:14px;font-weight:600;color:#fff;" id="voiceSt">Starting...</div>
      <button onclick="stopVoice()" style="margin-left:auto;background:transparent;border:none;color:#8b949e;font-size:18px;cursor:pointer;">‚úï</button>
    </div>
    <div style="font-size:12px;color:#555;line-height:1.8;font-family:Inter,sans-serif;">
      üí¨ <b style="color:#fff;">Stock search:</b> "Reliance price" ¬∑ "HDFC chart"<br>
      üìà <b style="color:#fff;">Buy/Sell:</b> "Buy 10 Reliance" ¬∑ "Sell 5 TCS"<br>
      üîî <b style="color:#fff;">Alert:</b> "Alert HDFC at 1700" ¬∑ "NIFTY above 25500"<br>
      üìã <b style="color:#fff;">Navigate:</b> "Open portfolio" ¬∑ "Show gainers"
    </div>`;
  document.body.appendChild(d);
}
function hideVoiceUI(){ document.getElementById('voiceUI')?.remove(); }
function updateVoiceUI(text,color){
  const st=document.getElementById('voiceSt');
  const dot=document.getElementById('voiceDot');
  if(st) st.textContent=text;
  if(dot) dot.style.background=color||'#17c3a8';
}

// ‚îÄ‚îÄ PROCESS VOICE COMMAND ‚îÄ‚îÄ
function processVoice(cmd){
  console.log('Voice cmd:', cmd);
  const nums = cmd.match(/\d+(?:,\d+)*(?:\.\d+)?/g);
  const price = nums ? parseFloat(nums[nums.length-1].replace(/,/g,'')) : null;
  const qty   = nums && nums.length>1 ? parseInt(nums[0]) : 1;

  // ‚îÄ‚îÄ STOCK SEARCH ‚Äî any stock name ‚îÄ‚îÄ
  const matchedStock = STOCKS.find(s=>
    cmd.includes(s.s.toLowerCase()) ||
    cmd.includes(s.n.toLowerCase().split(' ')[0]) ||
    cmd.includes(s.n.toLowerCase().split(' ')[1]||'__')
  );

  // ‚îÄ‚îÄ ALERT COMMANDS ‚îÄ‚îÄ
  // "alert reliance at 2900" / "reliance above 2900" / "hdfc below 1600"
  const isAlertCmd = cmd.includes('alert')||cmd.includes('above')||cmd.includes('below')||cmd.includes('target')||cmd.includes('notification');
  if(isAlertCmd && matchedStock && price){
    const type = cmd.includes('below')||cmd.includes('neeche') ? 'below' : 'above';
    addPriceAlert(matchedStock.s, price, type);
    return;
  }

  // ‚îÄ‚îÄ BUY COMMAND ‚îÄ‚îÄ
  // "buy 10 reliance" / "reliance kharido" / "reliance buy karo"
  const isBuy = cmd.includes('buy')||cmd.includes('kharido')||cmd.includes('le lo')||cmd.includes('lena');
  if(isBuy && matchedStock){
    curS = matchedStock;
    openOrder('BUY');
    if(price) document.getElementById('ovPr').value = price;
    if(qty>1) document.getElementById('ovQt').value = qty;
    calcMg();
    speak(`${matchedStock.s} ka BUY order window khola. Price ‚Çπ${price||matchedStock.p.toFixed(0)}, quantity ${qty}`);
    notif('üéôÔ∏è',`BUY ‚Äî ${matchedStock.s}`,`‚Çπ${price||matchedStock.p.toFixed(0)} ¬∑ Qty ${qty}`);
    return;
  }

  // ‚îÄ‚îÄ SELL COMMAND ‚îÄ‚îÄ
  const isSell = cmd.includes('sell')||cmd.includes('becho')||cmd.includes('bechna')||cmd.includes('hatao');
  if(isSell && matchedStock){
    curS = matchedStock;
    openOrder('SELL');
    if(price) document.getElementById('ovPr').value = price;
    if(qty>1) document.getElementById('ovQt').value = qty;
    calcMg();
    speak(`${matchedStock.s} ka SELL order window khola`);
    notif('üéôÔ∏è',`SELL ‚Äî ${matchedStock.s}`,`‚Çπ${price||matchedStock.p.toFixed(0)} ¬∑ Qty ${qty}`);
    return;
  }

  // ‚îÄ‚îÄ LTP / PRICE CHECK ‚îÄ‚îÄ
  const isPriceCheck = cmd.includes('price')||cmd.includes('ltp')||cmd.includes('rate')||cmd.includes('kitna')||cmd.includes('kya hai');
  if(isPriceCheck && matchedStock){
    const p = matchedStock.p;
    speak(`${matchedStock.n} ka current price hai ‚Çπ${p.toFixed(2)}`);
    notif('üí∞',`${matchedStock.s} ‚Äî LTP`,`‚Çπ${p.toLocaleString('en-IN',{maximumFractionDigits:2})}`);
    return;
  }

  // ‚îÄ‚îÄ OPEN STOCK CHART ‚îÄ‚îÄ
  if(matchedStock){
    openDet(matchedStock.s);
    speak(`${matchedStock.n} ka chart khol raha hun`);
    notif('üìä',`${matchedStock.s}`,`‚Çπ${matchedStock.p.toLocaleString('en-IN',{maximumFractionDigits:2})} ‚Äî chart khola`);
    return;
  }

  // ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
  if(cmd.includes('portfolio')||cmd.includes('holdings')){goTo('portfolio');speak('Portfolio dekho');return;}
  if(cmd.includes('watchlist')||cmd.includes('watch list')){goTo('watchlist');speak('Watchlist dekho');return;}
  if(cmd.includes('orders')||cmd.includes('order')){goTo('orders');speak('Orders dekho');return;}
  if(cmd.includes('home')){goTo('home');speak('Home screen pe aa gaye');return;}
  if(cmd.includes('profile')){goTo('profile');speak('Profile dekho');return;}

  // ‚îÄ‚îÄ SCANNERS ‚îÄ‚îÄ
  if(cmd.includes('gainer')||cmd.includes('top stock')){goTo('watchlist');scanTab='gainers';setWTab('scanner');speak('Aaj ke top gainers dikha raha hun');return;}
  if(cmd.includes('loser')||cmd.includes('girne wale')){goTo('watchlist');scanTab='losers';setWTab('scanner');speak('Losers dikha raha hun');return;}
  if(cmd.includes('short cover')){goTo('watchlist');scanTab='shortcover';setWTab('scanner');speak('Short covering stocks dikha raha hun');return;}
  if(cmd.includes('long build')){goTo('watchlist');scanTab='longbuild';setWTab('scanner');speak('Long buildup stocks dikha raha hun');return;}

  // ‚îÄ‚îÄ ALERTS PANEL ‚îÄ‚îÄ
  if(cmd.includes('alert')||cmd.includes('notification')){showAlertsScreen();return;}

  // ‚îÄ‚îÄ NIFTY/SENSEX price ‚îÄ‚îÄ
  if(cmd.includes('nifty')||cmd.includes('sensex')||cmd.includes('banknifty')){
    const idx=IDXS.find(x=>cmd.includes(x.s.toLowerCase().split(' ')[0]))||IDXS[0];
    speak(`${idx.s} abhi ‚Çπ${idx.p.toFixed(2)} pe hai, ${idx.c>=0?'upar':'neeche'} ${Math.abs(idx.pct).toFixed(2)} percent`);
    notif('üìä',idx.s,`‚Çπ${idx.p.toLocaleString('en-IN',{maximumFractionDigits:2})} ¬∑ ${idx.c>=0?'+':''}${idx.c.toFixed(2)}`);
    return;
  }

  // ‚îÄ‚îÄ NOT UNDERSTOOD ‚îÄ‚îÄ
  speak('Samajh nahi aaya, dobara boliye');
  notif('üéôÔ∏è',`Suna: "${cmd}"`, 'Koi match nahi mila');
}

// ‚îÄ‚îÄ DEMO VOICE (for browsers without SR) ‚îÄ‚îÄ
function demoVoice(){
  const demos=[
    'buy 10 reliance','alert hdfc at 1700','reliance price','show gainers',
    'open portfolio','sell 5 tcs','icici below 1050','nifty rate kya hai'
  ];
  const d=demos[Math.floor(Math.random()*demos.length)];
  showVoiceUI();
  setTimeout(()=>updateVoiceUI('"'+d+'"','#f59e0b'),500);
  setTimeout(()=>{stopVoice();processVoice(d);},1800);
}

// ‚îÄ‚îÄ ALERTS SCREEN ‚îÄ‚îÄ
function showAlertsScreen(){
  const overlay=document.createElement('div');
  overlay.id='alertsScreen';
  overlay.style.cssText='position:fixed;inset:0;background:#0e1016;z-index:800;display:flex;flex-direction:column;';
  const active=priceAlerts.filter(a=>a.active);
  overlay.innerHTML=`
    <div style="display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid #1a1f2e;flex-shrink:0;">
      <button onclick="document.getElementById('alertsScreen').remove()" style="background:#1c2130;border:none;color:#fff;width:34px;height:34px;border-radius:8px;cursor:pointer;font-size:16px;margin-right:12px;">‚Üê</button>
      <div style="font-size:20px;font-weight:700;color:#fff;">üîî Price Alerts</div>
      <button onclick="showVoiceAlertForm()" style="margin-left:auto;background:#17c3a8;border:none;color:#000;padding:8px 14px;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;">+ New Alert</button>
    </div>
    <div style="padding:12px 16px;background:#131820;border-bottom:1px solid #1a1f2e;flex-shrink:0;">
      <div style="font-size:13px;color:#8b949e;line-height:1.8;">
        üéôÔ∏è <b style="color:#fff;">Voice:</b> "Alert HDFC at 1700" ¬∑ "Reliance above 2900" ¬∑ "TCS below 3800"<br>
        üìû <b style="color:#fff;">Alert triggers:</b> Voice notification + Screen call + Alarm sound
      </div>
    </div>
    <div style="flex:1;overflow-y:auto;" id="alertsPanel"></div>
    <div style="padding:16px;flex-shrink:0;">
      <button onclick="showVoiceAlertForm()" style="width:100%;padding:14px;background:linear-gradient(135deg,#1a6b5e,#17c3a8);border:none;border-radius:12px;color:#000;font-size:15px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;">
        üéôÔ∏è Set Alert by Voice
      </button>
    </div>`;
  document.body.appendChild(overlay);
  renderAlertsPanel();
}

function showVoiceAlertForm(){
  // Quick manual form + voice option
  const overlay=document.createElement('div');
  overlay.id='alertForm';
  overlay.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:900;display:flex;align-items:flex-end;';
  overlay.innerHTML=`
    <div style="width:100%;background:#131820;border-radius:20px 20px 0 0;padding:20px 20px 40px;">
      <div style="width:32px;height:3px;background:#2a2f3e;border-radius:2px;margin:0 auto 16px;"></div>
      <div style="font-size:18px;font-weight:700;color:#fff;margin-bottom:16px;">üîî New Price Alert</div>
      <div style="margin-bottom:12px;">
        <div style="font-size:12px;color:#8b949e;margin-bottom:5px;font-weight:500;">STOCK SYMBOL</div>
        <input id="alSym" placeholder="e.g. RELIANCE, HDFC, TCS" style="width:100%;background:#0e1016;border:1px solid #2a2f3e;border-radius:10px;padding:12px;color:#fff;font-size:15px;outline:none;font-family:Inter,sans-serif;" oninput="this.value=this.value.toUpperCase()">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;">
        <div>
          <div style="font-size:12px;color:#8b949e;margin-bottom:5px;font-weight:500;">TARGET PRICE (‚Çπ)</div>
          <input id="alPrice" type="number" placeholder="2900" style="width:100%;background:#0e1016;border:1px solid #2a2f3e;border-radius:10px;padding:12px;color:#fff;font-size:15px;outline:none;font-family:Inter,sans-serif;">
        </div>
        <div>
          <div style="font-size:12px;color:#8b949e;margin-bottom:5px;font-weight:500;">TRIGGER TYPE</div>
          <select id="alType" style="width:100%;background:#0e1016;border:1px solid #2a2f3e;border-radius:10px;padding:12px;color:#fff;font-size:15px;outline:none;font-family:Inter,sans-serif;">
            <option value="above">‚Üë Price Upar Jaye</option>
            <option value="below">‚Üì Price Neeche Aaye</option>
          </select>
        </div>
      </div>
      <div style="background:#1a1f2e;border-radius:10px;padding:12px;margin-bottom:14px;font-size:13px;color:#8b949e;">
        üìû Alert trigger hone par: Voice call + Alarm + Screen notification
      </div>
      <div style="display:flex;gap:10px;">
        <button onclick="document.getElementById('alertForm').remove()" style="flex:1;padding:14px;background:#1c2130;border:none;border-radius:12px;color:#fff;font-size:15px;cursor:pointer;">Cancel</button>
        <button onclick="submitAlertForm()" style="flex:2;padding:14px;background:#17c3a8;border:none;border-radius:12px;color:#000;font-size:15px;font-weight:700;cursor:pointer;">Set Alert üîî</button>
      </div>
    </div>`;
  overlay.onclick=e=>{if(e.target===overlay)overlay.remove();};
  document.body.appendChild(overlay);
  setTimeout(()=>document.getElementById('alSym')?.focus(),300);
}

function submitAlertForm(){
  const sym=(document.getElementById('alSym')?.value||'').trim().toUpperCase();
  const price=parseFloat(document.getElementById('alPrice')?.value||0);
  const type=document.getElementById('alType')?.value||'above';
  if(!sym||!price){notif('‚ùå','Error','Stock aur price dono daalo');return;}
  const exists=STOCKS.find(s=>s.s===sym);
  if(!exists){notif('‚ùå','Stock Not Found',sym+' hamare database mein nahi hai');return;}
  document.getElementById('alertForm')?.remove();
  addPriceAlert(sym,price,type);
  renderAlertsPanel();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
if('serviceWorker' in navigator)navigator.serviceWorker.register('./sw.js').catch(()=>{});
buildHome();
setWTab('mylist');
setWTabActive();
</script>
</body>
</html>
